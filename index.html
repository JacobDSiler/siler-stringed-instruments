<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Siler Stringed Instruments — Handcrafted Since Forever</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Josefin+Sans:wght@200;300;400&display=swap" rel="stylesheet">

<!-- Firebase SDK v10 compat (must match project version) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
// ─── FIREBASE CONFIG (Siler Stringed Instruments) ────────────────────────────
const FIREBASE_CONFIG = {
  apiKey:            "AIzaSyDCuZP3OwNztxYWcPrzuxQbQEKHgEyeuvA",
  authDomain:        "siler-stringed-instruments.firebaseapp.com",
  projectId:         "siler-stringed-instruments",
  storageBucket:     "siler-stringed-instruments.firebasestorage.app",
  messagingSenderId: "807238649986",
  appId:             "1:807238649986:web:a3f048fb8ab4d97053cc9b"
};

// ─── EMAILJS CONFIG ───────────────────────────────────────────────────────────
// Paste your EmailJS credentials here (emailjs.com → Account → API Keys)
const EMAILJS_PUBLIC_KEY  = "PASTE_YOUR_EMAILJS_PUBLIC_KEY_HERE";
const EMAILJS_SERVICE_ID  = "PASTE_YOUR_EMAILJS_SERVICE_ID_HERE";
const EMAILJS_TEMPLATE_ID = "PASTE_YOUR_EMAILJS_TEMPLATE_ID_HERE";

// ─── INIT ─────────────────────────────────────────────────────────────────────
let db = null;
try {
  firebase.initializeApp(FIREBASE_CONFIG);
  db = firebase.firestore();
  console.log('✓ Firebase connected — project:', FIREBASE_CONFIG.projectId);
} catch(e) {
  console.warn('Firebase init failed:', e.message);
}
try {
  emailjs.init(EMAILJS_PUBLIC_KEY);
} catch(e) {
  console.warn('EmailJS init skipped (fill in key):', e.message);
}
</script>
<style>
  :root {
    --cream: #f5f0e8;
    --warm-white: #faf8f3;
    --dark: #1a1410;
    --brown: #4a2e1a;
    --amber: #c8772a;
    --amber-light: #e8a84a;
    --gold: #b8963c;
    --muted: #8a7a6a;
    --border: #d4c4a8;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html { scroll-behavior: smooth; }

  body {
    background: var(--cream);
    color: var(--dark);
    font-family: 'Libre Baskerville', serif;
    overflow-x: hidden;
  }

  /* ── GRAIN OVERLAY ── */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.4;
  }

  /* ── NAV ── */
  nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.2rem 3rem;
    background: rgba(245, 240, 232, 0.92);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    transition: all 0.3s ease;
  }

  .nav-logo {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.4rem;
    font-weight: 300;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--dark);
    text-decoration: none;
  }
  .nav-logo span { color: var(--amber); font-style: italic; }

  .nav-links {
    display: flex;
    gap: 2.5rem;
    list-style: none;
    align-items: center;
  }

  .nav-links a {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.2s;
  }
  .nav-links a:hover { color: var(--amber); }

  .cart-btn {
    background: var(--dark);
    color: var(--cream) !important;
    padding: 0.5rem 1.2rem;
    border-radius: 0;
    cursor: pointer;
    position: relative;
  }
  .cart-btn:hover { background: var(--amber) !important; color: var(--dark) !important; }

  /* Hidden admin link — invisible until hovered */
  .nav-admin-item { opacity: 0; transition: opacity 0.3s; }
  .nav-admin-item:hover { opacity: 1; }
  .nav-admin-link {
    color: rgba(138,122,106,0.5) !important;
    font-size: 0.62rem !important;
    letter-spacing: 0.15em !important;
  }
  .nav-admin-link:hover { color: var(--amber) !important; }

  .cart-count {
    position: absolute;
    top: -6px; right: -6px;
    background: var(--amber);
    color: var(--dark);
    width: 18px; height: 18px;
    border-radius: 50%;
    font-size: 0.65rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    display: none;
  }

  /* ── HERO ── */
  .hero {
    min-height: 100vh;
    display: grid;
    grid-template-columns: 1fr 1fr;
    padding-top: 5rem;
    overflow: hidden;
  }

  .hero-left {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 6rem 4rem 4rem 5rem;
    position: relative;
  }

  .hero-eyebrow {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.35em;
    text-transform: uppercase;
    color: var(--amber);
    margin-bottom: 1.5rem;
  }

  .hero-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(3.5rem, 6vw, 5.5rem);
    font-weight: 300;
    line-height: 1.05;
    color: var(--dark);
    margin-bottom: 1.5rem;
  }
  .hero-title em {
    font-style: italic;
    color: var(--amber);
    font-weight: 300;
  }

  .hero-sub {
    font-size: 1rem;
    line-height: 1.8;
    color: var(--muted);
    max-width: 380px;
    margin-bottom: 3rem;
    font-weight: 400;
  }

  .hero-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .btn-primary {
    background: var(--dark);
    color: var(--cream);
    padding: 0.9rem 2.2rem;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    border: none;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: all 0.25s ease;
  }
  .btn-primary:hover { background: var(--amber); color: var(--dark); }

  .btn-outline {
    background: transparent;
    color: var(--dark);
    padding: 0.9rem 2.2rem;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    border: 1px solid var(--border);
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: all 0.25s ease;
  }
  .btn-outline:hover { border-color: var(--amber); color: var(--amber); }

  .hero-right {
    position: relative;
    background: var(--dark);
    overflow: hidden;
  }

  .hero-img-container {
    position: absolute;
    inset: 0;
    /* flex removed — slides use position:absolute stacking */
  }

  .hero-guitar-graphic {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.75;
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(26,20,16,0.3) 0%, rgba(200,119,42,0.1) 100%);
    z-index: 2;
    pointer-events: none;
  }

  .hero-right-text {
    position: absolute;
    bottom: 3rem;
    right: 3rem;
    text-align: right;
    z-index: 3;
  }

  .hero-right-text p {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.1rem;
    font-style: italic;
    color: rgba(245,240,232,0.7);
    line-height: 1.6;
  }

  /* Guitar SVG placeholder */
  .guitar-hero-svg { width: 100%; height: 100%; }

  /* ── HERO SLIDESHOW ── */
  .hero-slide {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 1.2s ease;
    z-index: 1;
  }
  .hero-slide.active { opacity: 1; }
  .hero-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    display: block;
  }
  .hero-slide-nav {
    position: absolute;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 0.8rem;
    z-index: 10;
  }
  .hero-slide-prev, .hero-slide-next {
    background: rgba(245,240,232,0.15);
    border: 1px solid rgba(245,240,232,0.3);
    color: rgba(245,240,232,0.85);
    width: 32px; height: 32px;
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    backdrop-filter: blur(4px);
  }
  .hero-slide-prev:hover, .hero-slide-next:hover {
    background: rgba(200,119,42,0.6);
    color: white;
    border-color: var(--amber);
  }
  .hero-slide-dots { display: flex; gap: 0.4rem; }
  .hero-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: rgba(245,240,232,0.35);
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    padding: 0;
  }
  .hero-dot.active { background: var(--amber); transform: scale(1.4); }

  /* ── SECTION STYLES ── */
  section { padding: 6rem 5rem; }

  .section-header {
    display: flex;
    align-items: baseline;
    gap: 2rem;
    margin-bottom: 4rem;
  }

  .section-eyebrow {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.68rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--amber);
    white-space: nowrap;
  }

  .section-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2rem, 4vw, 3.2rem);
    font-weight: 300;
    color: var(--dark);
  }

  .section-line {
    flex: 1;
    height: 1px;
    background: var(--border);
    margin-left: 1rem;
  }

  /* ── SHOP / PRODUCTS ── */
  #shop { background: var(--warm-white); }

  .filter-bar {
    display: flex;
    gap: 1rem;
    margin-bottom: 3rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.68rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    padding: 0.5rem 1.2rem;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
  }
  .filter-btn.active, .filter-btn:hover {
    background: var(--dark);
    border-color: var(--dark);
    color: var(--cream);
  }

  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2.5rem;
  }

  .product-card {
    background: var(--cream);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  .product-card:hover { transform: translateY(-4px); box-shadow: 0 20px 60px rgba(26,20,16,0.12); }

  .product-img {
    width: 100%;
    aspect-ratio: 3/4;
    background: var(--dark);
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .product-img svg { opacity: 0.7; transition: opacity 0.3s, transform 0.3s; }
  .product-card:hover .product-img svg { opacity: 0.9; transform: scale(1.03); }

  .product-badge {
    position: absolute;
    top: 1rem; left: 1rem;
    background: var(--amber);
    color: var(--dark);
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    padding: 0.25rem 0.6rem;
  }

  .product-info {
    padding: 1.5rem;
  }

  .product-type {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--amber);
    margin-bottom: 0.4rem;
  }

  .product-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 400;
    color: var(--dark);
    margin-bottom: 0.5rem;
    line-height: 1.2;
  }

  .product-materials {
    font-size: 0.82rem;
    color: var(--muted);
    margin-bottom: 1rem;
    font-style: italic;
    line-height: 1.5;
  }

  .product-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
  }

  .product-price {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.6rem;
    color: var(--dark);
    font-weight: 400;
  }

  .add-to-cart {
    background: var(--dark);
    color: var(--cream);
    border: none;
    padding: 0.6rem 1.2rem;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }
  .add-to-cart:hover { background: var(--amber); color: var(--dark); }
  .add-to-cart.sold { background: var(--muted); cursor: not-allowed; }

  /* ── ABOUT STRIP ── */
  .about-strip {
    background: var(--dark);
    color: var(--cream);
    padding: 6rem 5rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6rem;
    align-items: center;
  }

  .about-left .section-eyebrow { color: var(--amber-light); }
  .about-left .section-title { color: var(--cream); font-size: 2.8rem; }

  .about-text {
    font-size: 1rem;
    line-height: 1.9;
    color: rgba(245,240,232,0.75);
    margin-top: 1.5rem;
  }

  .about-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }

  .stat-item {
    border-left: 2px solid var(--amber);
    padding-left: 1.2rem;
  }

  .stat-number {
    font-family: 'Cormorant Garamond', serif;
    font-size: 3rem;
    font-weight: 300;
    color: var(--cream);
    line-height: 1;
    margin-bottom: 0.3rem;
  }

  .stat-label {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--amber-light);
  }

  /* ── COMMISSION ── */
  #commission {
    background: var(--cream);
    padding: 6rem 5rem;
  }

  .commission-grid {
    display: grid;
    grid-template-columns: 1fr 1.4fr;
    gap: 6rem;
    align-items: start;
    margin-top: 4rem;
  }

  .commission-steps {
    counter-reset: steps;
  }

  .commission-step {
    counter-increment: steps;
    display: flex;
    gap: 1.5rem;
    margin-bottom: 2.5rem;
    padding-bottom: 2.5rem;
    border-bottom: 1px solid var(--border);
  }
  .commission-step:last-child { border-bottom: none; }

  .step-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.5rem;
    font-weight: 300;
    color: var(--amber);
    line-height: 1;
    min-width: 3rem;
  }
  .step-num::before { content: "0" counter(steps); }

  .step-content h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.3rem;
    font-weight: 400;
    margin-bottom: 0.4rem;
  }
  .step-content p {
    font-size: 0.88rem;
    color: var(--muted);
    line-height: 1.7;
  }

  /* COMMISSION FORM */
  .commission-form {
    background: var(--warm-white);
    border: 1px solid var(--border);
    padding: 2.5rem;
  }

  .form-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.8rem;
    font-weight: 300;
    margin-bottom: 0.5rem;
  }
  .form-subtitle {
    font-size: 0.85rem;
    color: var(--muted);
    margin-bottom: 2rem;
    font-style: italic;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.4rem;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 0.7rem 1rem;
    background: var(--cream);
    border: 1px solid var(--border);
    color: var(--dark);
    font-family: 'Libre Baskerville', serif;
    font-size: 0.9rem;
    outline: none;
    transition: border-color 0.2s;
    -webkit-appearance: none;
  }
  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus { border-color: var(--amber); }

  .form-group textarea { resize: vertical; min-height: 100px; }

  .form-submit {
    width: 100%;
    padding: 1rem;
    background: var(--dark);
    color: var(--cream);
    border: none;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.25s;
    margin-top: 0.5rem;
  }
  .form-submit:hover { background: var(--amber); color: var(--dark); }

  .form-success {
    display: none;
    text-align: center;
    padding: 2rem;
  }
  .form-success.show { display: block; }
  .form-success h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.8rem;
    font-weight: 300;
    color: var(--amber);
    margin-bottom: 0.5rem;
  }
  .form-success p { color: var(--muted); font-size: 0.9rem; }

  /* ── CART DRAWER ── */
  .cart-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,20,16,0.5);
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .cart-overlay.open { opacity: 1; pointer-events: all; }

  .cart-drawer {
    position: fixed;
    top: 0; right: 0; bottom: 0;
    width: 420px;
    background: var(--warm-white);
    z-index: 201;
    transform: translateX(100%);
    transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    display: flex;
    flex-direction: column;
    border-left: 1px solid var(--border);
  }
  .cart-drawer.open { transform: translateX(0); }

  .cart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--border);
  }

  .cart-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.4rem;
    font-weight: 300;
    letter-spacing: 0.05em;
  }

  .cart-close {
    background: none;
    border: none;
    font-size: 1.4rem;
    cursor: pointer;
    color: var(--muted);
    line-height: 1;
    padding: 0.2rem;
  }
  .cart-close:hover { color: var(--dark); }

  .cart-items {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem 2rem;
  }

  .cart-empty {
    text-align: center;
    padding: 3rem 0;
    color: var(--muted);
    font-style: italic;
  }

  .cart-item {
    display: flex;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border);
    align-items: start;
  }

  .cart-item-img {
    width: 60px;
    height: 80px;
    background: var(--dark);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cart-item-info { flex: 1; }
  .cart-item-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem;
    margin-bottom: 0.2rem;
  }
  .cart-item-sub {
    font-size: 0.78rem;
    color: var(--muted);
    font-style: italic;
    margin-bottom: 0.5rem;
  }
  .cart-item-price {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.1rem;
    color: var(--amber);
  }

  .cart-item-remove {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
  }
  .cart-item-remove:hover { color: var(--dark); }

  .cart-footer {
    padding: 1.5rem 2rem;
    border-top: 1px solid var(--border);
  }

  .cart-total {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 1.5rem;
  }
  .cart-total-label {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
  }
  .cart-total-amount {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.8rem;
    color: var(--dark);
  }

  .cart-checkout {
    width: 100%;
    padding: 1rem;
    background: var(--dark);
    color: var(--cream);
    border: none;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    cursor: pointer;
    margin-bottom: 0.8rem;
    transition: all 0.2s;
  }
  .cart-checkout:hover { background: var(--amber); color: var(--dark); }

  .cart-inquiry-note {
    font-size: 0.78rem;
    color: var(--muted);
    text-align: center;
    font-style: italic;
    line-height: 1.5;
  }

  /* ── PRODUCT MODAL ── */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,20,16,0.7);
    z-index: 300;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }

  .product-modal {
    background: var(--warm-white);
    max-width: 900px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    position: relative;
    transform: scale(0.95);
    transition: transform 0.3s;
  }
  .modal-overlay.open .product-modal { transform: scale(1); }

  .modal-close {
    position: absolute;
    top: 1rem; right: 1rem;
    background: var(--dark);
    color: var(--cream);
    border: none;
    width: 32px; height: 32px;
    cursor: pointer;
    font-size: 1rem;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-img {
    background: var(--dark);
    min-height: 400px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-body {
    padding: 2.5rem;
    display: flex;
    flex-direction: column;
  }

  .modal-type {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--amber);
    margin-bottom: 0.6rem;
  }

  .modal-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 300;
    line-height: 1.1;
    margin-bottom: 1rem;
  }

  .modal-price {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    color: var(--amber);
    margin-bottom: 1.5rem;
  }

  .modal-divider {
    height: 1px;
    background: var(--border);
    margin-bottom: 1.5rem;
  }

  .modal-desc {
    font-size: 0.9rem;
    line-height: 1.8;
    color: var(--muted);
    margin-bottom: 1.5rem;
    flex: 1;
  }

  .modal-specs {
    margin-bottom: 1.5rem;
  }

  .modal-specs-title {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.8rem;
  }

  .spec-row {
    display: flex;
    justify-content: space-between;
    padding: 0.4rem 0;
    border-bottom: 1px solid var(--border);
    font-size: 0.85rem;
  }
  .spec-key { color: var(--muted); }
  .spec-val { color: var(--dark); font-style: italic; }

  .modal-add {
    width: 100%;
    padding: 1rem;
    background: var(--dark);
    color: var(--cream);
    border: none;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }
  .modal-add:hover { background: var(--amber); color: var(--dark); }
  .modal-add.sold { background: var(--muted); cursor: not-allowed; }

  /* ── CHECKOUT FORM ── */
  .checkout-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,20,16,0.8);
    z-index: 400;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }
  .checkout-overlay.open { opacity: 1; pointer-events: all; }

  .checkout-modal {
    background: var(--warm-white);
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    padding: 3rem;
    position: relative;
    transform: scale(0.95);
    transition: transform 0.3s;
  }
  .checkout-overlay.open .checkout-modal { transform: scale(1); }

  .checkout-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 300;
    margin-bottom: 0.4rem;
  }
  .checkout-sub {
    font-size: 0.85rem;
    color: var(--muted);
    font-style: italic;
    margin-bottom: 2rem;
  }

  .checkout-summary {
    background: var(--cream);
    border: 1px solid var(--border);
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .checkout-summary-title {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 1rem;
  }

  .checkout-item-row {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    margin-bottom: 0.4rem;
    font-style: italic;
    color: var(--dark);
  }

  .checkout-total-row {
    display: flex;
    justify-content: space-between;
    padding-top: 0.8rem;
    margin-top: 0.8rem;
    border-top: 1px solid var(--border);
  }
  .checkout-total-row span:first-child {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    align-self: center;
  }
  .checkout-total-row span:last-child {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    color: var(--amber);
  }

  .checkout-note {
    background: rgba(200,119,42,0.08);
    border-left: 3px solid var(--amber);
    padding: 1rem 1.2rem;
    font-size: 0.85rem;
    color: var(--brown);
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .checkout-success {
    display: none;
    text-align: center;
    padding: 2rem 0;
  }
  .checkout-success.show { display: block; }
  .checkout-success h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.5rem;
    font-weight: 300;
    color: var(--amber);
    margin-bottom: 0.8rem;
  }
  .checkout-success p {
    color: var(--muted);
    font-size: 0.9rem;
    line-height: 1.7;
    margin-bottom: 1rem;
  }

  /* ── FOOTER ── */
  footer {
    background: var(--dark);
    color: rgba(245,240,232,0.6);
    padding: 4rem 5rem 2rem;
  }

  .footer-top {
    display: grid;
    grid-template-columns: 1.5fr 1fr 1fr;
    gap: 4rem;
    margin-bottom: 3rem;
    padding-bottom: 3rem;
    border-bottom: 1px solid rgba(245,240,232,0.1);
  }

  .footer-brand {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 300;
    letter-spacing: 0.1em;
    color: var(--cream);
    margin-bottom: 1rem;
  }
  .footer-brand span { color: var(--amber); font-style: italic; }

  .footer-desc {
    font-size: 0.88rem;
    line-height: 1.7;
    color: rgba(245,240,232,0.5);
  }

  .footer-col h4 {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--amber-light);
    margin-bottom: 1.2rem;
  }

  .footer-col ul { list-style: none; }
  .footer-col li { margin-bottom: 0.6rem; }
  .footer-col a {
    color: rgba(245,240,232,0.5);
    text-decoration: none;
    font-size: 0.88rem;
    transition: color 0.2s;
    cursor: pointer;
  }
  .footer-col a:hover { color: var(--amber-light); }

  .footer-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.78rem;
    color: rgba(245,240,232,0.3);
    font-family: 'Josefin Sans', sans-serif;
    letter-spacing: 0.1em;
  }

  /* ── TOAST ── */
  .toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--dark);
    color: var(--cream);
    padding: 0.9rem 2rem;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    z-index: 500;
    transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    border-left: 3px solid var(--amber);
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* ── SCROLL ANIMATIONS ── */
  .fade-in {
    opacity: 0;
    transform: translateY(24px);
    transition: opacity 0.7s ease, transform 0.7s ease;
  }
  .fade-in.visible { opacity: 1; transform: translateY(0); }

  /* ── LIVING TREASURE BADGE ── */
  .living-treasure-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.6rem;
    background: rgba(200, 119, 42, 0.15);
    border: 1px solid var(--amber);
    color: var(--amber-light);
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.68rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    padding: 0.4rem 1rem;
    margin-bottom: 1.5rem;
  }
  .lt-star { color: var(--amber); font-size: 0.8rem; }

  /* ── VIDEO EMBED ── */
  .video-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    border: 1px solid rgba(200,119,42,0.3);
  }
  .video-wrapper iframe {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
  }

  /* ── ABOUT RIGHT COLUMN ── */
  .about-right-col {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }
  .about-portrait-wrap {
    width: 100%;
    aspect-ratio: 4/3;
    overflow: hidden;
    border: 1px solid rgba(200,119,42,0.25);
  }
  .about-portrait {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center top;
    filter: sepia(15%) contrast(1.05);
    transition: transform 0.6s ease;
  }
  .about-portrait:hover { transform: scale(1.03); }

  /* ── GALLERY SECTION ── */
  #gallery { background: var(--dark); padding: 5rem; }
  #gallery .section-eyebrow { color: var(--amber); }
  #gallery .section-title { color: var(--cream); }
  #gallery .section-line { background: rgba(200,119,42,0.3); }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-auto-rows: 280px;
    gap: 6px;
    margin-top: 3rem;
  }

  .gallery-item {
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background: #0d0905;
  }
  .gallery-item.wide { grid-column: span 2; }
  .gallery-item.tall { grid-row: span 2; }

  .gallery-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease, filter 0.4s ease;
    filter: sepia(10%) brightness(0.9);
  }
  .gallery-item:hover img {
    transform: scale(1.07);
    filter: sepia(0%) brightness(1.05);
  }

  .gallery-item-caption {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    background: linear-gradient(transparent, rgba(26,20,16,0.85));
    padding: 2rem 1.2rem 1rem;
    transform: translateY(100%);
    transition: transform 0.35s ease;
  }
  .gallery-item:hover .gallery-item-caption { transform: translateY(0); }
  .gallery-item-caption span {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--amber-light);
  }

  /* Lightbox */
  .lightbox-overlay {
    position: fixed;
    inset: 0;
    background: rgba(10,8,6,0.95);
    z-index: 400;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }
  .lightbox-overlay.open { opacity: 1; pointer-events: all; }
  .lightbox-img {
    max-width: 90vw;
    max-height: 90vh;
    object-fit: contain;
    box-shadow: 0 40px 120px rgba(0,0,0,0.8);
  }
  .lightbox-close {
    position: absolute;
    top: 1.5rem; right: 1.5rem;
    background: none;
    border: 1px solid rgba(200,119,42,0.5);
    color: var(--amber);
    width: 40px; height: 40px;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .lightbox-close:hover { background: var(--amber); color: var(--dark); }

  @media (max-width: 900px) {
    #gallery { padding: 3rem 1.5rem; }
    .gallery-grid { grid-template-columns: repeat(2, 1fr); grid-auto-rows: 200px; }
    .gallery-item.wide { grid-column: span 1; }
    .gallery-item.tall { grid-row: span 1; }
    .about-right-col { margin-top: 2rem; }
    .about-strip { grid-template-columns: 1fr; }
  }

  /* ── JOURNAL / ARTICLES ── */
  #journal { background: var(--cream); padding: 6rem 5rem; }

  .journal-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2.5rem;
    margin-top: 3rem;
  }

  .journal-card {
    background: var(--warm-white);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.3s ease;
    overflow: hidden;
  }
  .journal-card:hover { transform: translateY(-3px); box-shadow: 0 16px 48px rgba(26,20,16,0.1); }

  .journal-card-img {
    width: 100%;
    aspect-ratio: 16/9;
    overflow: hidden;
    background: var(--dark);
  }
  .journal-card-img img {
    width: 100%; height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
    referrerpolicy: no-referrer;
  }
  .journal-card:hover .journal-card-img img { transform: scale(1.04); }
  .journal-card-img-placeholder {
    width: 100%;
    aspect-ratio: 16/9;
    background: linear-gradient(135deg, #2a1810, #4a2e1a);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    opacity: 0.5;
  }

  .journal-card-body { padding: 1.5rem; }
  .journal-card-cat {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--amber);
    margin-bottom: 0.5rem;
  }
  .journal-card-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.45rem;
    font-weight: 400;
    color: var(--dark);
    line-height: 1.2;
    margin-bottom: 0.6rem;
  }
  .journal-card-excerpt {
    font-size: 0.84rem;
    color: var(--muted);
    line-height: 1.7;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .journal-card-meta {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    opacity: 0.7;
  }

  .journal-empty {
    grid-column: 1/-1;
    text-align: center;
    padding: 4rem 2rem;
    color: var(--muted);
    font-style: italic;
  }
  .journal-empty p { font-size: 0.95rem; line-height: 1.7; margin-top: 0.5rem; }

  /* Article reader overlay */
  .article-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,20,16,0.85);
    z-index: 450;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 2rem;
    overflow-y: auto;
  }
  .article-overlay.open { opacity: 1; pointer-events: all; }

  .article-reader {
    background: var(--warm-white);
    max-width: 760px;
    width: 100%;
    position: relative;
    transform: translateY(20px);
    transition: transform 0.3s;
    margin: auto;
  }
  .article-overlay.open .article-reader { transform: translateY(0); }

  .article-hero-img {
    width: 100%;
    aspect-ratio: 16/7;
    object-fit: cover;
    display: block;
  }
  .article-hero-placeholder {
    width: 100%;
    aspect-ratio: 16/7;
    background: linear-gradient(135deg, #2a1810 0%, #4a2e1a 100%);
    display: flex; align-items: center; justify-content: center;
    font-size: 5rem; opacity: 0.4;
  }

  .article-header {
    padding: 2.5rem 3rem 1.5rem;
    border-bottom: 1px solid var(--border);
  }
  .article-cat {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 0.28em;
    text-transform: uppercase;
    color: var(--amber);
    margin-bottom: 0.8rem;
  }
  .article-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(1.8rem, 4vw, 2.8rem);
    font-weight: 300;
    line-height: 1.15;
    color: var(--dark);
    margin-bottom: 1rem;
  }
  .article-byline {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .article-body {
    padding: 2rem 3rem 3rem;
    font-size: 1rem;
    line-height: 1.95;
    color: var(--dark);
  }
  .article-body h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.6rem;
    font-weight: 400;
    margin: 2rem 0 0.8rem;
    color: var(--dark);
  }
  .article-body h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.25rem;
    font-weight: 400;
    margin: 1.5rem 0 0.5rem;
    color: var(--brown);
  }
  .article-body p { margin-bottom: 1.2rem; }
  .article-body img {
    width: 100%;
    margin: 1.5rem 0;
    display: block;
  }
  .article-body img.img-left {
    float: left;
    width: 45%;
    margin: 0.5rem 1.5rem 1rem 0;
  }
  .article-body img.img-right {
    float: right;
    width: 45%;
    margin: 0.5rem 0 1rem 1.5rem;
  }
  .article-body blockquote {
    border-left: 3px solid var(--amber);
    margin: 1.5rem 0;
    padding: 0.8rem 1.5rem;
    background: rgba(200,119,42,0.05);
    font-style: italic;
    color: var(--brown);
  }

  .article-footer {
    padding: 1.5rem 3rem 2rem;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .article-share-btn {
    background: var(--amber);
    color: var(--dark);
    border: none;
    padding: 0.7rem 1.5rem;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .article-share-btn:hover { background: var(--dark); color: var(--cream); }

  .article-close-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 0.7rem 1.5rem;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }
  .article-close-btn:hover { border-color: var(--dark); color: var(--dark); }

  .article-overlay-close {
    position: fixed;
    top: 1rem; right: 1rem;
    background: var(--dark);
    color: var(--cream);
    border: none;
    width: 36px; height: 36px;
    font-size: 1rem;
    cursor: pointer;
    z-index: 460;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.2s;
  }
  .article-overlay-close:hover { background: var(--amber); color: var(--dark); }

  /* Share toast */
  .share-copied {
    position: fixed;
    bottom: 2rem; left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--amber);
    color: var(--dark);
    padding: 0.7rem 1.5rem;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    z-index: 900;
    transition: transform 0.3s;
  }
  .share-copied.show { transform: translateX(-50%) translateY(0); }

  /* Admin article tab styles */
  .rich-toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
    padding: 6px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(200,119,42,0.2);
    border-bottom: none;
  }
  .rich-btn {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(200,119,42,0.2);
    color: rgba(245,240,232,0.75);
    padding: 3px 8px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.15s;
    font-family: sans-serif;
    line-height: 1.4;
  }
  .rich-btn:hover { background: var(--amber); color: var(--dark); border-color: var(--amber); }
  .rich-editor {
    width: 100%;
    min-height: 220px;
    padding: 0.9rem 1rem;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(200,119,42,0.25);
    color: var(--cream);
    font-family: 'Libre Baskerville', serif;
    font-size: 0.88rem;
    line-height: 1.8;
    outline: none;
  }
  .rich-editor:focus { border-color: var(--amber); }
  .rich-editor [contenteditable] { outline: none; }

  .journal-article-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.85rem 0;
    border-bottom: 1px solid rgba(200,119,42,0.12);
  }
  .journal-article-thumb {
    width: 60px; height: 40px;
    object-fit: cover;
    flex-shrink: 0;
    background: #2a1810;
  }
  .journal-article-info { flex: 1; min-width: 0; }
  .journal-article-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem;
    color: var(--cream);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .journal-article-meta { font-size: 0.72rem; color: rgba(245,240,232,0.4); font-style: italic; }
  @media (max-width: 900px) {
    nav { padding: 1rem 1.5rem; }
    .nav-links { gap: 1.2rem; }
    section { padding: 4rem 2rem; }
    .hero { grid-template-columns: 1fr; min-height: auto; }
    .hero-left { padding: 8rem 2rem 4rem; }
    .hero-right { min-height: 300px; }
    .about-strip { grid-template-columns: 1fr; gap: 3rem; padding: 4rem 2rem; }
    .commission-grid { grid-template-columns: 1fr; gap: 3rem; }
    .product-modal { grid-template-columns: 1fr; }
    .modal-img { min-height: 250px; }
    .footer-top { grid-template-columns: 1fr; gap: 2rem; }
    .cart-drawer { width: 100%; max-width: 420px; }
    .form-row { grid-template-columns: 1fr; }
  }

  /* ── ADMIN PANEL ── */
  /* Admin accessed via hidden nav link (visible on hover only) */

  .admin-overlay {
    position: fixed;
    inset: 0;
    background: rgba(10,8,6,0.75);
    z-index: 850;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
  }
  .admin-overlay.open { opacity: 1; pointer-events: all; }

  .admin-panel {
    background: var(--dark);
    border: 1px solid rgba(200,119,42,0.3);
    width: 100%;
    max-width: 620px;
    max-height: 88vh;
    overflow-y: auto;
    color: var(--cream);
    transform: scale(0.96) translateY(12px);
    transition: transform 0.3s;
  }
  .admin-overlay.open .admin-panel { transform: scale(1) translateY(0); }

  .admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid rgba(200,119,42,0.2);
  }
  .admin-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 300;
    color: var(--cream);
  }
  .admin-close {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 1.3rem;
    cursor: pointer;
    line-height: 1;
    padding: 0.2rem;
    transition: color 0.2s;
  }
  .admin-close:hover { color: var(--amber); }

  .admin-sub {
    padding: 1.5rem 2rem 0;
    font-size: 0.88rem;
    color: rgba(245,240,232,0.6);
    font-style: italic;
  }

  .admin-tabs {
    display: flex;
    border-bottom: 1px solid rgba(200,119,42,0.2);
    padding: 0 1rem;
    gap: 0;
    overflow-x: auto;
  }
  .admin-tab {
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    color: rgba(245,240,232,0.5);
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    padding: 0.9rem 1rem;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
  }
  .admin-tab:hover { color: var(--amber-light); }
  .admin-tab.active { color: var(--amber); border-bottom-color: var(--amber); }

  .admin-tab-content { padding: 1.5rem 2rem 2rem; }
  .admin-section-label {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--amber);
    margin-bottom: 1.2rem;
  }

  /* override form styles for dark panel */
  .admin-panel .form-group label { color: rgba(245,240,232,0.6); }
  .admin-panel .form-group input,
  .admin-panel .form-group select,
  .admin-panel .form-group textarea {
    background: rgba(255,255,255,0.06);
    border-color: rgba(200,119,42,0.25);
    color: var(--cream);
  }
  .admin-panel .form-group input::placeholder,
  .admin-panel .form-group textarea::placeholder { color: rgba(245,240,232,0.3); }
  .admin-panel .form-group input:focus,
  .admin-panel .form-group select:focus,
  .admin-panel .form-group textarea:focus { border-color: var(--amber); }
  .admin-panel .form-group select option { background: #2a1810; color: var(--cream); }

  /* image upload area */
  .admin-img-upload-area {
    width: 100%;
    aspect-ratio: 16/7;
    border: 2px dashed rgba(200,119,42,0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    overflow: hidden;
    position: relative;
    background: rgba(255,255,255,0.04);
    transition: border-color 0.2s;
  }
  .admin-img-upload-area:hover { border-color: var(--amber); }
  .admin-img-upload-area.has-img { border-style: solid; }
  .upload-preview {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1.5rem;
    text-align: center;
    pointer-events: none;
  }
  .upload-icon { font-size: 2rem; }
  .upload-preview p { font-size: 0.82rem; color: rgba(245,240,232,0.5); line-height: 1.5; }
  .upload-hint { font-size: 0.75rem !important; color: rgba(245,240,232,0.35) !important; }
  .upload-hint a { color: var(--amber) !important; }

  .admin-paste-btn {
    background: rgba(200,119,42,0.2);
    border: 1px solid rgba(200,119,42,0.4);
    color: var(--amber-light);
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 0.7rem 0.9rem;
    cursor: pointer;
    white-space: nowrap;
    flex-shrink: 0;
    transition: all 0.2s;
  }
  .admin-paste-btn:hover { background: var(--amber); color: var(--dark); }

  /* admin product list */
  .admin-product-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.85rem 0;
    border-bottom: 1px solid rgba(200,119,42,0.12);
  }
  .admin-product-thumb {
    width: 50px;
    height: 50px;
    object-fit: cover;
    flex-shrink: 0;
    background: #2a1810;
  }
  .admin-product-thumb-placeholder {
    width: 50px;
    height: 50px;
    background: #2a1810;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--amber);
    font-size: 1.2rem;
    flex-shrink: 0;
  }
  .admin-product-info { flex: 1; min-width: 0; }
  .admin-product-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem;
    color: var(--cream);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .admin-product-meta {
    font-size: 0.75rem;
    color: rgba(245,240,232,0.45);
    font-style: italic;
  }
  .admin-product-actions { display: flex; gap: 0.4rem; flex-shrink: 0; }
  .admin-btn-toggle, .admin-btn-delete {
    border: none;
    padding: 0.35rem 0.7rem;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }
  .admin-btn-toggle { background: rgba(200,119,42,0.2); color: var(--amber-light); }
  .admin-btn-toggle:hover { background: var(--amber); color: var(--dark); }
  .admin-btn-delete { background: rgba(180,60,60,0.2); color: #e88; }
  .admin-btn-delete:hover { background: #c03030; color: #fff; }

  /* admin pw hint */
  .admin-pw-hint { margin-top: 0.6rem; font-size: 0.8rem; color: #e88; font-style: italic; height: 1.2rem; }

  /* help steps */
  .admin-help-steps { display: flex; flex-direction: column; gap: 1.2rem; }
  .help-step {
    display: flex;
    gap: 1.2rem;
    align-items: flex-start;
    padding-bottom: 1.2rem;
    border-bottom: 1px solid rgba(200,119,42,0.12);
  }
  .help-step:last-child { border-bottom: none; }
  .help-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 300;
    color: var(--amber);
    line-height: 1;
    min-width: 2.2rem;
    text-align: center;
  }
  .help-step strong {
    display: block;
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--amber-light);
    margin-bottom: 0.4rem;
  }
  .help-step p { font-size: 0.85rem; color: rgba(245,240,232,0.65); line-height: 1.7; }

  /* gallery admin thumbs */
  .gal-admin-thumb {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
  }
  .gal-admin-thumb img { width:100%;height:100%;object-fit:cover; }
  .gal-admin-thumb button {
    position: absolute;
    top: 4px; right: 4px;
    background: rgba(180,60,60,0.85);
    border: none;
    color: #fff;
    width: 22px; height: 22px;
    font-size: 0.75rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .admin-forgot-link {
    background: none;
    border: none;
    color: rgba(200,119,42,0.65);
    font-family: 'Josefin Sans', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    cursor: pointer;
    padding: 0.8rem 0 0;
    display: block;
    text-decoration: underline;
    transition: color 0.2s;
  }
  .admin-forgot-link:hover { color: var(--amber); }

  .admin-status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: #666;
    display: inline-block;
    margin-right: 0.4rem;
    vertical-align: middle;
  }
  .admin-status-dot.connected { background: #4caf50; }
  .admin-status-dot.error { background: #e55; }

  @media (max-width: 600px) {
    .admin-panel { max-width: 100%; max-height: 95vh; }
  }
</style>
</head>
<body>

<!-- NAV -->
<nav id="navbar">
  <a href="#" class="nav-logo">Siler <span>Stringed</span> Instruments</a>
  <ul class="nav-links">
    <li><a href="#shop">Shop</a></li>
    <li><a href="#gallery">Gallery</a></li>
    <li><a href="#journal">Journal</a></li>
    <li><a href="#about">About</a></li>
    <li><a href="#commission">Commission</a></li>
    <li><a href="#commission" class="btn-primary" style="padding:0.4rem 1rem;">Inquire</a></li>
    <li class="nav-admin-item">
      <a class="nav-admin-link" onclick="openAdmin()" href="javascript:void(0)">Admin</a>
    </li>
    <li><a class="cart-btn" onclick="openCart()">
      Cart
      <span class="cart-count" id="cartCount">0</span>
    </a></li>
  </ul>
</nav>

<!-- HERO -->
<section class="hero" id="home">
  <div class="hero-left">
    <p class="hero-eyebrow">Arkansas Living Treasure · Handcrafted in the USA · Est. 1980</p>
    <h1 class="hero-title">Every note<br>begins with<br><em>the wood.</em></h1>
    <p class="hero-sub">Each instrument is built by hand — one at a time, with carefully selected tonewoods, time-proven joinery, and a luthier's patient eye for detail.</p>
    <div class="hero-actions">
      <a href="#shop" class="btn-primary">View Instruments</a>
      <a href="#commission" class="btn-outline">Request a Commission</a>
    </div>
  </div>
  <div class="hero-right">
    <div class="hero-img-container" id="heroSlideshow">
      <!-- Slides injected by JS -->
    </div>
    <div class="hero-slide-nav">
      <button class="hero-slide-prev" onclick="heroSlide(-1)" aria-label="Previous">&#8592;</button>
      <div class="hero-slide-dots" id="heroSlideDots"></div>
      <button class="hero-slide-next" onclick="heroSlide(1)" aria-label="Next">&#8594;</button>
    </div>
    <div class="hero-overlay"></div>
    <div class="hero-right-text">
      <p>"I build instruments<br>that ask to be played."<br>— Dennis J. Siler</p>
    </div>
  </div>
</section>

<!-- SHOP -->
<section id="shop">
  <div class="section-header fade-in">
    <span class="section-eyebrow">Available Now</span>
    <h2 class="section-title">Instruments for Sale</h2>
    <div class="section-line"></div>
  </div>
  
  <div class="filter-bar fade-in">
    <button class="filter-btn active" onclick="filterProducts('all', this)">All</button>
    <button class="filter-btn" onclick="filterProducts('guitar', this)">Guitars</button>
    <button class="filter-btn" onclick="filterProducts('other', this)">Other Instruments</button>
    <button class="filter-btn" onclick="filterProducts('repair', this)">Repaired / Restored</button>
  </div>

  <div class="products-grid" id="productsGrid">
    <!-- Rendered by JS -->
  </div>
</section>

<!-- GALLERY -->
<section id="gallery">
  <div class="section-header fade-in">
    <span class="section-eyebrow">The Craft</span>
    <h2 class="section-title">From the Workshop</h2>
    <div class="section-line"></div>
  </div>

  <div class="gallery-grid">
    <!-- Row 1: wide feature + tall detail -->
    <div class="gallery-item wide" onclick="openLightbox('https://i.postimg.cc/vZTMJ4fW/1c7d037b-29b4-4a06-a763-99bc023d6a5d.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/vZTMJ4fW/1c7d037b-29b4-4a06-a763-99bc023d6a5d.jpg" alt="Siler dreadnought acoustic guitar">
      <div class="gallery-item-caption"><span>Dreadnought — Spruce & Rosewood</span></div>
    </div>
    <div class="gallery-item tall" onclick="openLightbox('https://i.postimg.cc/RZh9kWKY/04f7295c-b0ce-4d9d-af21-21108906b0b6.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/RZh9kWKY/04f7295c-b0ce-4d9d-af21-21108906b0b6.jpg" alt="Guitar headstock detail">
      <div class="gallery-item-caption"><span>Headstock Detail — Walnut</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/nhWZpn18/a37e3ad9-9cde-4693-866f-718340124dde.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/nhWZpn18/a37e3ad9-9cde-4693-866f-718340124dde.jpg" alt="Guitar back — exotic figured wood">
      <div class="gallery-item-caption"><span>Back — Figured Exotic Wood</span></div>
    </div>

    <!-- Row 2 -->
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/NjFY3Km3/6cf208a8-d30d-4e95-9f1b-87e04f6c49b4.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/NjFY3Km3/6cf208a8-d30d-4e95-9f1b-87e04f6c49b4.jpg" alt="Guitar back — Osage Orange">
      <div class="gallery-item-caption"><span>Back — Osage Orange</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/9QkVCcYg/27dab5c9-86b3-4364-9fa0-80342a9eb47f.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/9QkVCcYg/27dab5c9-86b3-4364-9fa0-80342a9eb47f.jpg" alt="Abalone fretboard inlay">
      <div class="gallery-item-caption"><span>Vine Inlay — Abalone</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/Cx2YSwsQ/7d809df8-9f93-4fe3-a280-84f201a2f739.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/Cx2YSwsQ/7d809df8-9f93-4fe3-a280-84f201a2f739.jpg" alt="Siler Stringed Instruments label">
      <div class="gallery-item-caption"><span>Sound Hole Label — Est. 1980</span></div>
    </div>

    <!-- Row 3: feature + details -->
    <div class="gallery-item wide" onclick="openLightbox('https://i.postimg.cc/qvF04pGR/e4209d31-205f-42cd-8258-e5a10cab3572.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/qvF04pGR/e4209d31-205f-42cd-8258-e5a10cab3572.jpg" alt="Siler OM guitar in case">
      <div class="gallery-item-caption"><span>OM Guitar — Cedar Top</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/jS1KtR4p/961e6be5-2607-4460-add8-cdbc6b092fc2.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/jS1KtR4p/961e6be5-2607-4460-add8-cdbc6b092fc2.jpg" alt="Rosette and soundhole detail">
      <div class="gallery-item-caption"><span>Rosette — August 2018</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/jS1KtRhS/bc3825ae-9d44-42c2-a195-fe4185a46431.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/jS1KtRhS/bc3825ae-9d44-42c2-a195-fe4185a46431.jpg" alt="Guitar back — rosewood and neck">
      <div class="gallery-item-caption"><span>Back & Neck — Rosewood</span></div>
    </div>

    <!-- Row 4: harp, banjos, dulcimer -->
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/RZY94vLY/353acdf0-f47b-4f9c-abf1-c6c6e930395b.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/RZY94vLY/353acdf0-f47b-4f9c-abf1-c6c6e930395b.jpg" alt="Handbuilt Celtic harp">
      <div class="gallery-item-caption"><span>Celtic Harp — Walnut & Maple</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/3xq7Y3ZH/b2ce22ca-6c83-486d-9a17-6103cf7d6567.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/3xq7Y3ZH/b2ce22ca-6c83-486d-9a17-6103cf7d6567.jpg" alt="Minstrel / fretless banjo">
      <div class="gallery-item-caption"><span>Minstrel Banjo — Fretless</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/K8WFxm5c/ba140368-34b3-4114-acf7-acf9be012655.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/K8WFxm5c/ba140368-34b3-4114-acf7-acf9be012655.jpg" alt="Mountain dulcimer">
      <div class="gallery-item-caption"><span>Mountain Dulcimer</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/Vkh1mzFv/d4c5c5d3-4de7-476c-88dd-bff5f4d25237.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/Vkh1mzFv/d4c5c5d3-4de7-476c-88dd-bff5f4d25237.jpg" alt="Abalone binding detail">
      <div class="gallery-item-caption"><span>Abalone Binding Detail</span></div>
    </div>

    <!-- Row 5: sunburst + 12-string -->
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/nhWZpn18/a37e3ad9-9cde-4693-866f-718340124dde.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/nhWZpn18/a37e3ad9-9cde-4693-866f-718340124dde.jpg" alt="Sunburst OM guitar in case">
      <div class="gallery-item-caption"><span>Sunburst OM Guitar</span></div>
    </div>
    <div class="gallery-item wide" onclick="openLightbox('https://i.postimg.cc/qvF04pGR/e4209d31-205f-42cd-8258-e5a10cab3572.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/qvF04pGR/e4209d31-205f-42cd-8258-e5a10cab3572.jpg" alt="12-string Siler guitar" style="object-position: top;">
      <div class="gallery-item-caption"><span>12-String Guitar — Spruce Top</span></div>
    </div>
    <div class="gallery-item" onclick="openLightbox('https://i.postimg.cc/9Q0V6DZs/5df96386-a597-47c6-8c2f-2b8d78f9544c.jpg')">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/9Q0V6DZs/5df96386-a597-47c6-8c2f-2b8d78f9544c.jpg" alt="Binding and purfling detail">
      <div class="gallery-item-caption"><span>Binding & Purfling Detail</span></div>
    </div>
  </div>
</section>

<!-- LIGHTBOX -->
<div class="lightbox-overlay" id="lightboxOverlay" onclick="closeLightbox(event)">
  <button class="lightbox-close" onclick="closeLightbox()">✕</button>
  <img class="lightbox-img" id="lightboxImg" src="" alt="">
</div>

<!-- JOURNAL -->
<section id="journal">
  <div class="section-header fade-in">
    <span class="section-eyebrow">From the Workshop</span>
    <h2 class="section-title">Dennis's Journal</h2>
    <div class="section-line"></div>
  </div>
  <div class="journal-grid" id="journalGrid">
    <!-- Rendered by JS -->
  </div>
</section>

<!-- ARTICLE READER OVERLAY -->
<div class="article-overlay" id="articleOverlay" onclick="closeArticleCheck(event)">
  <button class="article-overlay-close" onclick="closeArticle()">✕</button>
  <div class="article-reader" id="articleReader">
    <!-- Injected by JS -->
  </div>
</div>

<!-- SHARE TOAST -->
<div class="share-copied" id="shareCopied">Link copied to clipboard!</div>

<!-- ABOUT -->
<div class="about-strip" id="about">
  <div class="about-left">
    <span class="section-eyebrow">The Luthier</span>
    <h2 class="section-title">Dennis J. Siler</h2>
    <div class="living-treasure-badge">
      <span class="lt-star">★</span>
      Arkansas Living Treasure
      <span class="lt-star">★</span>
    </div>
    <p class="about-text">
      Dennis has spent over 40 years learning the art of stringed instrument construction — a craft where millimetres matter and patience is the most important tool in the shop. From selecting raw tonewoods to final setup and playability, every instrument is built with the care of someone who plays as well as builds.
    </p>
    <p class="about-text" style="margin-top:1rem;">
      He also offers repairs, restorations, and teaching — because a great instrument is only half of the story.
    </p>
    <div style="margin-top:2rem;">
      <a href="#commission" class="btn-primary">Get in Touch</a>
    </div>

    <!-- YouTube Video -->
    <div class="about-video" style="margin-top:2.5rem;">
      <p style="font-family:'Josefin Sans',sans-serif;font-size:0.68rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--amber-light);margin-bottom:0.8rem;">Watch — Meet the Luthier</p>
      <div class="video-wrapper">
        <iframe
          src="https://www.youtube.com/embed/k6pyjJ_F3W4"
          title="Dennis J. Siler — Arkansas Living Treasure Luthier"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
      </div>
    </div>
  </div>

  <div class="about-right-col">
    <div class="about-portrait-wrap">
      <img referrerpolicy="no-referrer" crossorigin="anonymous" src="https://i.postimg.cc/7ZRDwqNk/abc8270f-55ac-45cd-a8e9-e945d886dbfb.jpg" alt="Dennis J. Siler with one of his handcrafted banjos" class="about-portrait">
    </div>
    <div class="about-stats">
      <div class="stat-item">
        <div class="stat-number">40+</div>
        <div class="stat-label">Years Building</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">100%</div>
        <div class="stat-label">Handcrafted</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">All</div>
        <div class="stat-label">Stringed Types</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">Est.<br><span style="font-size:1.6rem">1980</span></div>
        <div class="stat-label">Est. in Arkansas</div>
      </div>
    </div>
  </div>
</div>

<!-- COMMISSION -->
<section id="commission">
  <div class="section-header fade-in">
    <span class="section-eyebrow">Custom Orders</span>
    <h2 class="section-title">Commission an Instrument</h2>
    <div class="section-line"></div>
  </div>

  <div class="commission-grid">
    <div class="commission-steps fade-in">
      <div class="commission-step">
        <div class="step-num"></div>
        <div class="step-content">
          <h3>Tell Me What You're After</h3>
          <p>Share the type of instrument, your playing style, tonal preferences, and any special requirements. There are no wrong answers — this is just the start of a conversation.</p>
        </div>
      </div>
      <div class="commission-step">
        <div class="step-num"></div>
        <div class="step-content">
          <h3>Wood & Design Selection</h3>
          <p>Together we'll choose tonewoods, body style, scale length, and cosmetic details. Dennis will advise based on your sound goals and experience level.</p>
        </div>
      </div>
      <div class="commission-step">
        <div class="step-num"></div>
        <div class="step-content">
          <h3>Build & Updates</h3>
          <p>Your instrument enters the build queue. You'll receive updates with photos as it takes shape — seeing your instrument come to life is part of the experience.</p>
        </div>
      </div>
      <div class="commission-step">
        <div class="step-num"></div>
        <div class="step-content">
          <h3>Final Setup & Delivery</h3>
          <p>Every instrument is set up for playability before it leaves the workshop. Delivery is arranged directly with you, including full packaging and insurance.</p>
        </div>
      </div>
    </div>

    <div class="commission-form">
      <div id="commissionFormWrap">
        <h3 class="form-title">Start a Conversation</h3>
        <p class="form-subtitle">No commitment — just a chat about what you're dreaming of.</p>
        
        <div class="form-row">
          <div class="form-group">
            <label>First Name</label>
            <input type="text" id="cf_first" placeholder="Your name">
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" id="cf_last" placeholder="Last name">
          </div>
        </div>
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="cf_email" placeholder="your@email.com">
        </div>
        <div class="form-group">
          <label>Instrument Type</label>
          <select id="cf_type">
            <option value="">Select a type…</option>
            <option>Steel String Acoustic Guitar</option>
            <option>Classical / Nylon String Guitar</option>
            <option>Electric Guitar</option>
            <option>Bass Guitar</option>
            <option>Mandolin</option>
            <option>Ukulele</option>
            <option>Banjo</option>
            <option>Violin / Fiddle</option>
            <option>Other — I'll explain below</option>
          </select>
        </div>
        <div class="form-group">
          <label>Budget Range</label>
          <select id="cf_budget">
            <option value="">Approximate budget…</option>
            <option>Under $1,000</option>
            <option>$1,000 – $2,000</option>
            <option>$2,000 – $3,500</option>
            <option>$3,500 – $5,000</option>
            <option>$5,000+</option>
            <option>Open — let's talk</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tell Me More</label>
          <textarea id="cf_message" placeholder="Playing style, tonal preferences, special requests, timeline…"></textarea>
        </div>
        <button class="form-submit" onclick="submitCommission()">Send Enquiry →</button>
      </div>
      <div class="form-success" id="commissionSuccess">
        <h3>Message Received</h3>
        <p>Thank you for reaching out. Dennis will be in touch within a few days to continue the conversation.</p>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div class="footer-top">
    <div>
      <div class="footer-brand">Siler <span>Stringed</span> Instruments</div>
      <p class="footer-desc">Handcrafted stringed instruments built one at a time with care, precision, and a deep respect for the tradition of lutherie. Every instrument is signed and numbered.</p>
    </div>
    <div class="footer-col">
      <h4>Navigate</h4>
      <ul>
        <li><a onclick="scrollTo('shop')">Shop</a></li>
        <li><a onclick="scrollTo('gallery')">Gallery</a></li>
        <li><a onclick="scrollTo('journal')">Journal</a></li>
        <li><a onclick="scrollTo('about')">About Dennis</a></li>
        <li><a onclick="scrollTo('commission')">Commission</a></li>
        <li><a onclick="scrollTo('commission')">Repairs & Restoration</a></li>
        <li><a onclick="scrollTo('commission')">Teaching</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h4>Get in Touch</h4>
      <ul>
        <li><a href="/cdn-cgi/l/email-protection#751c1b131a35061c19100712001c011407065b161a18"><span class="__cf_email__" data-cfemail="6b02050d042b1802070e190c1e021f0a191845080406">[email&#160;protected]</span></a></li>
        <li><a href="https://silerguitars.com" target="_blank">silerguitars.com</a></li>
        <li><a onclick="scrollTo('commission')">Send an Enquiry</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    <span>© <span id="adminTrigger" title="">Dennis J. Siler</span> — All instruments handbuilt in the USA</span>
    <span>Site by Siler Family</span>
  </div>
</footer>

<!-- CART OVERLAY + DRAWER -->
<div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>
<div class="cart-drawer" id="cartDrawer">
  <div class="cart-header">
    <span class="cart-title">Your Cart</span>
    <button class="cart-close" onclick="closeCart()">✕</button>
  </div>
  <div class="cart-items" id="cartItemsList">
    <p class="cart-empty">Your cart is empty.</p>
  </div>
  <div class="cart-footer" id="cartFooter" style="display:none">
    <div class="cart-total">
      <span class="cart-total-label">Total</span>
      <span class="cart-total-amount" id="cartTotal">$0</span>
    </div>
    <button class="cart-checkout" onclick="openCheckout()">Proceed to Enquiry →</button>
    <p class="cart-inquiry-note">Each purchase is confirmed via email. Dennis will follow up personally to arrange payment and shipping.</p>
  </div>
</div>

<!-- PRODUCT MODAL -->
<div class="modal-overlay" id="productModal" onclick="closeModal(event)">
  <div class="product-modal" id="modalContent">
    <button class="modal-close" onclick="closeProductModal()">✕</button>
    <div class="modal-img" id="modalImg"></div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<!-- CHECKOUT OVERLAY -->
<div class="checkout-overlay" id="checkoutOverlay" onclick="closeCheckout(event)">
  <div class="checkout-modal" id="checkoutModal">
    <button class="modal-close" onclick="closeCheckoutModal()" style="position:absolute;top:1rem;right:1rem">✕</button>
    <div id="checkoutFormWrap">
      <h2 class="checkout-title">Enquiry & Purchase</h2>
      <p class="checkout-sub">Dennis will confirm availability and arrange payment personally.</p>
      
      <div class="checkout-summary" id="checkoutSummary"></div>

      <div class="checkout-note">
        These instruments are handcrafted one-of-a-kind pieces. Placing an enquiry holds your interest — Dennis will confirm availability and discuss payment (bank transfer, cheque, or PayPal) and shipping arrangements with you directly within 48 hours.
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>First Name</label>
          <input type="text" id="ch_first" placeholder="First name">
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" id="ch_last" placeholder="Last name">
        </div>
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="ch_email" placeholder="your@email.com">
      </div>
      <div class="form-group">
        <label>Phone (optional)</label>
        <input type="tel" id="ch_phone" placeholder="+1 (555) 000-0000">
      </div>
      <div class="form-group">
        <label>Country / Region</label>
        <input type="text" id="ch_country" placeholder="Country">
      </div>
      <div class="form-group">
        <label>Any Questions or Notes</label>
        <textarea id="ch_notes" placeholder="Questions about the instrument, shipping, etc."></textarea>
      </div>
      <button class="form-submit" onclick="submitCheckout()">Send Purchase Enquiry →</button>
    </div>
    <div class="checkout-success" id="checkoutSuccess">
      <h2>You're All Set</h2>
      <p>Dennis has received your enquiry and will be in touch within 48 hours to confirm availability and arrange payment and delivery.</p>
      <p style="margin-top:1rem;">In the meantime, feel free to <a href="/cdn-cgi/l/email-protection#d6bfb8b0b996a5bfbab3a4b1a3bfa2b7a4a5f8b5b9bb" style="color:var(--amber)">email directly</a> with any questions.</p>
      <button class="btn-outline" style="margin-top:2rem" onclick="closeCheckoutModal()">Back to Shop</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">Added to cart</div>

<!-- ═══════════════════════════════════════════════════════
     ADMIN PANEL — Product Manager
     Click the gold "Admin" button (bottom-right) to open.
     Password: siler1980
═══════════════════════════════════════════════════════ -->
<!-- Admin access: hover over the end of the nav bar to reveal the hidden "Admin" link -->

<div class="admin-overlay" id="adminOverlay" onclick="closeAdminCheck(event)">
  <div class="admin-panel" id="adminPanel">

    <!-- LOGIN SCREEN -->
    <div id="adminLogin">
      <div class="admin-header">
        <h2 class="admin-title">Siler Instruments — Admin</h2>
        <button class="admin-close" onclick="closeAdmin()">✕</button>
      </div>

      <!-- Login form -->
      <div id="adminLoginForm" style="padding:1.5rem 2rem 2rem">
        <p class="admin-sub" style="padding:0 0 1.5rem">Enter the admin password to manage listings.</p>
        <div class="form-group">
          <label>Password</label>
          <div style="display:flex;gap:0.5rem;align-items:center">
            <input type="password" id="adminPw" placeholder="••••••••"
              onkeydown="if(event.key==='Enter')checkAdminPw()"
              style="flex:1">
            <button class="admin-paste-btn" onclick="togglePwVisibility()" id="pwToggleBtn"
              style="padding:0.7rem 0.8rem;font-size:0.9rem">👁</button>
          </div>
        </div>
        <button class="form-submit" id="loginBtn" onclick="checkAdminPw()">Unlock →</button>
        <p class="admin-pw-hint" id="adminPwHint"></p>
        <button class="admin-forgot-link" onclick="showRecovery()">Forgot password?</button>
      </div>

      <!-- Change password form (shown after first login or via settings) -->
      <div id="adminChangePwForm" style="display:none;padding:0 2rem 2rem">
        <div class="admin-section-label" style="margin-bottom:1rem">Change Admin Password</div>
        <div class="form-group">
          <label>Current Password</label>
          <input type="password" id="cp_current" placeholder="Current password">
        </div>
        <div class="form-group">
          <label>New Password</label>
          <input type="password" id="cp_new" placeholder="New password (min 6 chars)">
        </div>
        <div class="form-group">
          <label>Confirm New Password</label>
          <input type="password" id="cp_confirm" placeholder="Repeat new password">
        </div>
        <div style="display:flex;gap:0.8rem">
          <button class="form-submit" style="flex:1" onclick="changePassword()">Save New Password →</button>
          <button class="admin-paste-btn" onclick="document.getElementById('adminChangePwForm').style.display='none';document.getElementById('adminLoginForm').style.display='block'">Cancel</button>
        </div>
        <p class="admin-pw-hint" id="changePwHint"></p>
      </div>

      <!-- Recovery form -->
      <div id="adminRecoveryForm" style="display:none;padding:0 2rem 2rem">
        <div class="admin-section-label" style="margin-bottom:0.4rem">Password Recovery</div>
        <p style="font-size:0.84rem;color:rgba(245,240,232,0.55);line-height:1.6;margin-bottom:1.2rem;font-style:italic">
          Your recovery email address is stored securely in Firebase. Enter it below — if it matches, we'll send you the current password.
        </p>
        <div class="form-group">
          <label>Your Recovery Email</label>
          <input type="email" id="recoveryEmail" placeholder="your@email.com"
            onkeydown="if(event.key==='Enter')sendRecovery()">
        </div>
        <button class="form-submit" id="recoveryBtn" onclick="sendRecovery()">Send Recovery Email →</button>
        <p class="admin-pw-hint" id="recoveryHint" style="color:var(--amber-light)"></p>
        <button class="admin-forgot-link" onclick="showLogin()">← Back to login</button>
      </div>
    </div>

    <!-- MAIN ADMIN (hidden until login) -->
    <div id="adminMain" style="display:none">
      <div class="admin-header">
        <div>
          <h2 class="admin-title">Product Manager</h2>
          <p style="font-size:0.72rem;color:rgba(245,240,232,0.4);margin-top:0.2rem;font-family:'Josefin Sans',sans-serif;letter-spacing:0.1em">
            <span class="admin-status-dot" id="firebaseStatusDot"></span>
            <span id="firebaseStatusTxt">Checking…</span>
            &nbsp;·&nbsp;
            <button onclick="showChangePwFromMain()" style="background:none;border:none;color:rgba(200,119,42,0.6);font-family:'Josefin Sans',sans-serif;font-size:0.65rem;letter-spacing:0.1em;cursor:pointer;text-decoration:underline;padding:0" title="Change password">Change password</button>
          </p>
        </div>
        <button class="admin-close" onclick="closeAdmin()">✕</button>
      </div>

      <!-- TABS -->
      <div class="admin-tabs">
        <button class="admin-tab active" onclick="switchAdminTab('add',this)">＋ Add Listing</button>
        <button class="admin-tab" onclick="switchAdminTab('manage',this)">✎ Manage Listings</button>
        <button class="admin-tab" onclick="switchAdminTab('journal',this)">✍ Journal</button>
        <button class="admin-tab" onclick="switchAdminTab('gallery',this)">⬛ Gallery</button>
        <button class="admin-tab" onclick="switchAdminTab('help',this)">? How To</button>
      </div>

      <!-- TAB: ADD -->
      <div class="admin-tab-content" id="tab-add">
        <div class="admin-section-label">Add a New Instrument for Sale</div>
        
        <!-- Image uploader -->
        <div class="admin-img-upload-area" id="imgUploadArea">
          <div class="upload-preview" id="uploadPreview">
            <span class="upload-icon">📷</span>
            <p>Paste a PostImg URL below, or drag & drop a photo here</p>
            <p class="upload-hint">Free upload: <a href="https://postimages.org" target="_blank" style="color:var(--amber)">postimages.org</a> → get Direct link</p>
          </div>
          <img id="uploadPreviewImg" src="" alt="" style="display:none;width:100%;height:100%;object-fit:cover;">
        </div>

        <div class="form-group">
          <label>Photo URL (PostImg or any direct image URL)</label>
          <div style="display:flex;gap:0.5rem">
            <input type="url" id="add_photo" placeholder="https://i.postimg.cc/..." oninput="previewPhoto(this.value)">
            <button class="admin-paste-btn" onclick="pasteFromClipboard('add_photo')">Paste</button>
          </div>
          <p class="upload-hint" style="margin-top:0.4rem">Tip: Upload to <a href="https://postimages.org" target="_blank" style="color:var(--amber)">postimages.org</a>, choose "Direct link" and paste here.</p>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Instrument Name</label>
            <input type="text" id="add_name" placeholder="e.g. Dreadnought No. 14">
          </div>
          <div class="form-group">
            <label>Price ($)</label>
            <input type="number" id="add_price" placeholder="2800">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Type</label>
            <select id="add_type">
              <option value="guitar">Guitar</option>
              <option value="other">Other Instrument</option>
              <option value="repair">Repaired / Restored</option>
            </select>
          </div>
          <div class="form-group">
            <label>Label (shown on card)</label>
            <input type="text" id="add_label" placeholder="Guitar / Banjo / Harp…">
          </div>
        </div>
        <div class="form-group">
          <label>Materials (shown under name)</label>
          <input type="text" id="add_materials" placeholder="Sitka Spruce top · Rosewood back & sides">
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="add_desc" placeholder="A detailed description of this instrument…" style="min-height:80px"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Badge (optional)</label>
            <input type="text" id="add_badge" placeholder="New / Featured / Rare">
          </div>
          <div class="form-group" style="display:flex;align-items:center;gap:0.8rem;padding-top:1.6rem">
            <input type="checkbox" id="add_available" checked style="width:18px;height:18px;cursor:pointer">
            <label style="font-family:'Josefin Sans',sans-serif;font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;margin:0;cursor:pointer" for="add_available">Available for Sale</label>
          </div>
        </div>
        <button class="form-submit" onclick="addProduct()">Add to Shop →</button>
        <div id="addSuccess" style="display:none;margin-top:1rem;padding:0.8rem;background:rgba(200,119,42,0.15);border-left:3px solid var(--amber);color:var(--amber-light);font-family:'Josefin Sans',sans-serif;font-size:0.75rem;letter-spacing:0.1em">
          ✓ Listing added successfully!
        </div>
      </div>

      <!-- TAB: MANAGE -->
      <div class="admin-tab-content" id="tab-manage" style="display:none">
        <div class="admin-section-label">Current Listings</div>
        <div id="adminProductList"></div>
      </div>

      <!-- TAB: JOURNAL -->
      <div class="admin-tab-content" id="tab-journal" style="display:none">

        <!-- Write new article -->
        <div id="journalWritePanel">
          <div class="admin-section-label">Write a New Article</div>

          <div class="form-row">
            <div class="form-group">
              <label>Title</label>
              <input type="text" id="art_title" placeholder="e.g. How I Build a Spruce Top">
            </div>
            <div class="form-group">
              <label>Category</label>
              <select id="art_cat">
                <option>Build Process</option>
                <option>Wood & Materials</option>
                <option>Instruments</option>
                <option>Workshop Life</option>
                <option>Stories</option>
                <option>Tips & Advice</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Cover Image URL (optional — PostImg direct link)</label>
            <div style="display:flex;gap:0.5rem">
              <input type="url" id="art_cover" placeholder="https://i.postimg.cc/..." oninput="previewArticleCover(this.value)">
              <button class="admin-paste-btn" onclick="pasteFromClipboard('art_cover')">Paste</button>
            </div>
            <img id="art_cover_preview" src="" alt="" style="display:none;width:100%;margin-top:0.5rem;max-height:140px;object-fit:cover;">
          </div>

          <div class="form-group" style="margin-bottom:0">
            <label>Article Body</label>
          </div>
          <!-- Rich text toolbar -->
          <div class="rich-toolbar">
            <button class="rich-btn" onclick="artFmt('bold')" title="Bold"><b>B</b></button>
            <button class="rich-btn" onclick="artFmt('italic')" title="Italic"><i>I</i></button>
            <button class="rich-btn" onclick="artFmt('underline')" title="Underline"><u>U</u></button>
            <button class="rich-btn" onclick="artFmtBlock('h2')" title="Heading">H2</button>
            <button class="rich-btn" onclick="artFmtBlock('h3')" title="Sub-heading">H3</button>
            <button class="rich-btn" onclick="artFmtBlock('blockquote')" title="Quote">❝</button>
            <button class="rich-btn" onclick="artFmt('insertUnorderedList')" title="Bullet list">• List</button>
            <button class="rich-btn" onclick="artFmt('insertOrderedList')" title="Numbered list">1. List</button>
            <button class="rich-btn" onclick="artInsertImg('full')" title="Insert image full width">⬛ Img</button>
            <button class="rich-btn" onclick="artInsertImg('left')" title="Insert image float left">◧ Img Left</button>
            <button class="rich-btn" onclick="artInsertImg('right')" title="Insert image float right">◨ Img Right</button>
            <button class="rich-btn" onclick="artFmt('removeFormat')" title="Clear formatting">✕ Fmt</button>
          </div>
          <div class="rich-editor" id="artEditor" contenteditable="true"
            placeholder="Start writing here… use the toolbar above to format and add images."></div>

          <div style="display:flex;gap:0.8rem;margin-top:1rem">
            <button class="form-submit" style="flex:1" onclick="publishArticle()">Publish Article →</button>
          </div>
          <div id="artSuccess" style="display:none;margin-top:1rem;padding:0.8rem;background:rgba(200,119,42,0.15);border-left:3px solid var(--amber);color:var(--amber-light);font-family:'Josefin Sans',sans-serif;font-size:0.75rem;letter-spacing:0.1em">
            ✓ Article published!
          </div>
        </div>

        <!-- Manage existing articles -->
        <div style="margin-top:2.5rem">
          <div class="admin-section-label">Published Articles</div>
          <div id="adminArticleList">
            <p style="color:rgba(245,240,232,0.35);font-style:italic;font-size:0.85rem">No articles yet. Write your first one above!</p>
          </div>
        </div>
      </div>

      <!-- TAB: GALLERY -->
      <div class="admin-tab-content" id="tab-gallery" style="display:none">
        <div class="admin-section-label">Add an Image to the Gallery</div>
        <div class="form-group">
          <label>Image URL (PostImg direct link)</label>
          <div style="display:flex;gap:0.5rem">
            <input type="url" id="gal_url" placeholder="https://i.postimg.cc/...">
            <button class="admin-paste-btn" onclick="pasteFromClipboard('gal_url')">Paste</button>
          </div>
        </div>
        <div class="form-group">
          <label>Caption</label>
          <input type="text" id="gal_caption" placeholder="e.g. Rosette detail — 2024">
        </div>
        <button class="form-submit" onclick="addGalleryImage()">Add to Gallery →</button>
        <div id="galSuccess" style="display:none;margin-top:1rem;padding:0.8rem;background:rgba(200,119,42,0.15);border-left:3px solid var(--amber);color:var(--amber-light);font-family:'Josefin Sans',sans-serif;font-size:0.75rem;letter-spacing:0.1em">
          ✓ Image added to gallery!
        </div>
        <div class="admin-section-label" style="margin-top:2rem">Current Gallery Images</div>
        <div id="adminGalleryList" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:1rem"></div>
      </div>

      <!-- TAB: HELP -->
      <div class="admin-tab-content" id="tab-help" style="display:none">
        <div class="admin-section-label">How to Add Photos with PostImages</div>
        <div class="admin-help-steps">
          <div class="help-step">
            <div class="help-num">1</div>
            <div>
              <strong>Go to postimages.org</strong>
              <p>Visit <a href="https://postimages.org" target="_blank" style="color:var(--amber)">postimages.org</a> in your browser. No account needed — it's completely free.</p>
            </div>
          </div>
          <div class="help-step">
            <div class="help-num">2</div>
            <div>
              <strong>Upload your photo</strong>
              <p>Click "Choose images" and select a photo from your phone or computer. Click the green upload button.</p>
            </div>
          </div>
          <div class="help-step">
            <div class="help-num">3</div>
            <div>
              <strong>Copy the "Direct link"</strong>
              <p>After uploading, you'll see several link options. Copy the one labelled <em>Direct link</em> — it should end in .jpg or .png and start with https://i.postimg.cc/…</p>
            </div>
          </div>
          <div class="help-step">
            <div class="help-num">4</div>
            <div>
              <strong>Paste into the Admin Panel</strong>
              <p>Come back here, open "Add Listing" or "Gallery Images", paste the URL into the Photo URL field, fill in the details, and click Add.</p>
            </div>
          </div>
          <div class="help-step">
            <div class="help-num">5</div>
            <div>
              <strong>That's it!</strong>
              <p>Your listing or gallery photo appears on the site instantly. To save changes permanently, use the export button below.</p>
            </div>
          </div>
        </div>
        <div style="margin-top:2rem;padding:1rem;background:rgba(200,119,42,0.1);border:1px solid rgba(200,119,42,0.3)">
          <p style="font-family:'Josefin Sans',sans-serif;font-size:0.68rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--amber-light);margin-bottom:0.5rem">⚠ Note on Saving</p>
          <p style="font-size:0.85rem;color:rgba(245,240,232,0.7);line-height:1.7">Changes made through this panel are <em>live on the page right now</em> but won't survive a page refresh unless you download the updated file. Ask your site helper to export &amp; re-upload after making changes, or use a host that supports server-side storage.</p>
        </div>
      </div>

    </div><!-- /adminMain -->
  </div><!-- /adminPanel -->
</div><!-- /adminOverlay -->

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ─── DATA ───────────────────────────────────────────────────────────────────
// ┌─────────────────────────────────────────────────────────────────────────────┐
// │  HOW TO ADD A NEW INSTRUMENT FOR SALE (easy way):                           │
// │  Click the gold "Admin" button in the bottom-right corner of the page.      │
// │  Fill in the form, paste a PostImg (or any image) URL for the photo,        │
// │  and click Add. The listing appears instantly!                               │
// │                                                                              │
// │  HOW TO ADD VIA CODE:                                                        │
// │  1. Upload your photo to https://postimages.org (free, no account needed)   │
// │  2. Copy the "Direct link" URL (ends in .jpg)                               │
// │  3. Add a new object to the PRODUCTS array below                            │
// │  4. Set photo: "https://i.postimg.cc/XXXX/your-image.jpg"                   │
// │  5. Save — done!                                                             │
// └─────────────────────────────────────────────────────────────────────────────┘
const PRODUCTS = [
  {
    id: 1,
    name: "Dreadnought No. 11",
    type: "guitar",
    label: "Guitar",
    available: true,
    badge: "Available",
    price: 2800,
    photo: "https://i.postimg.cc/vZTMJ4fW/1c7d037b-29b4-4a06-a763-99bc023d6a5d.jpg",
    materials: "Sitka Spruce top · Rosewood back & sides · Mahogany neck",
    desc: "A beautifully balanced dreadnought with a Sitka spruce top for crisp highs and a warm mid-range. The Indian rosewood back and sides add depth and complexity. Hand-fitted bone nut and saddle, gold hardware.",
    specs: [
      ["Body Style", "Dreadnought"],
      ["Top", "Sitka Spruce, book-matched"],
      ["Back & Sides", "Indian Rosewood"],
      ["Neck", "Mahogany, hand-shaped"],
      ["Fingerboard", "Ebony, 14-fret"],
      ["Scale Length", '25.4"'],
      ["Nut Width", '1 3/4"'],
      ["Finish", "Nitrocellulose lacquer"],
      ["Tuners", "Gotoh Gold"],
    ],
    color: "#2a1810"
  },
  {
    id: 2,
    name: "OM Guitar — Abalone Vine",
    type: "guitar",
    label: "Guitar",
    available: true,
    badge: "Featured",
    price: 3400,
    photo: "https://i.postimg.cc/9QkVCcYg/27dab5c9-86b3-4364-9fa0-80342a9eb47f.jpg",
    materials: "Spruce top · Rosewood back & sides · Abalone fretboard vine inlay",
    desc: "A stunning orchestra model featuring a full abalone vine inlay running the length of the fretboard — one of the most elaborate inlay jobs Dennis has completed. Exceptional tone and a showpiece of the luthier's art.",
    specs: [
      ["Body Style", "Orchestra Model (OM)"],
      ["Top", "Sitka Spruce"],
      ["Back & Sides", "Indian Rosewood"],
      ["Inlay", "Full-board abalone vine"],
      ["Fingerboard", "Ebony, 14-fret"],
      ["Scale Length", '25.4"'],
      ["Nut Width", '1 3/4"'],
      ["Finish", "Nitrocellulose lacquer"],
    ],
    color: "#2a1810"
  },
  {
    id: 3,
    name: "Celtic Harp",
    type: "other",
    label: "Harp",
    available: true,
    badge: "Rare",
    price: 2200,
    photo: "https://i.postimg.cc/RZY94vLY/353acdf0-f47b-4f9c-abf1-c6c6e930395b.jpg",
    materials: "Walnut soundboard · Figured maple pillar · 26 strings",
    desc: "A hand-built Celtic harp in walnut and curly maple. 26 strings spanning over three octaves — perfect for folk, Celtic, and classical repertoire. Beautiful figured maple column with walnut soundboard.",
    specs: [
      ["Style", "Celtic / Folk Harp"],
      ["Strings", "26"],
      ["Soundboard", "Walnut"],
      ["Pillar", "Figured Maple"],
      ["Levers", "Silver blade levers"],
      ["Finish", "Hand-rubbed oil"],
    ],
    color: "#3a2510"
  },
  {
    id: 4,
    name: "OM Guitar — August 2018",
    type: "guitar",
    label: "Guitar",
    available: true,
    badge: null,
    price: 3200,
    photo: "https://i.postimg.cc/Cx2YSwsQ/7d809df8-9f93-4fe3-a280-84f201a2f739.jpg",
    materials: "Spruce top · Abalone rosette · Tortoise-shell pickguard",
    desc: "A finely crafted orchestra model from August 2018 with an abalone rosette and beautiful tortoise-shell pickguard. The spruce top projects with clarity and warmth. A balanced instrument equally suited to fingerpicking and flatpicking.",
    specs: [
      ["Body Style", "Orchestra Model"],
      ["Top", "Sitka Spruce"],
      ["Rosette", "Multi-ring abalone"],
      ["Pickguard", "Tortoiseshell-style"],
      ["Fingerboard", "Ebony"],
      ["Year Built", "August 2018"],
      ["Finish", "Nitrocellulose"],
    ],
    color: "#1e1208"
  },
  {
    id: 5,
    name: "Sunburst OM Guitar",
    type: "guitar",
    label: "Guitar",
    available: true,
    badge: "Available",
    price: 2600,
    photo: "https://i.postimg.cc/nhWZpn18/a37e3ad9-9cde-4693-866f-718340124dde.jpg",
    materials: "Spruce top · Sunburst finish · Rosewood fingerboard",
    desc: "A rich sunburst OM-style guitar with a dramatic amber-to-dark burst finish. Excellent projection and a warm, rounded tone ideal for blues, folk, and country styles.",
    specs: [
      ["Body Style", "Orchestra Model"],
      ["Top", "Spruce"],
      ["Finish", "Sunburst nitrocellulose"],
      ["Fingerboard", "Rosewood"],
      ["Tuners", "Gotoh Gold"],
      ["Nut", "Bone"],
    ],
    color: "#1a0e06"
  },
  {
    id: 6,
    name: "Minstrel / Open-Back Banjo",
    type: "other",
    label: "Banjo",
    available: true,
    badge: null,
    price: 1100,
    photo: "https://i.postimg.cc/3xq7Y3ZH/b2ce22ca-6c83-486d-9a17-6103cf7d6567.jpg",
    materials: "Walnut neck · Fretless · Natural head · Period hardware",
    desc: "A historically-styled minstrel banjo with a fretless neck and open-back pot. Built in the tradition of 19th-century American banjos — authentic tone and feel for old-time and minstrel repertoire.",
    specs: [
      ["Style", "Minstrel / Open-Back"],
      ["Neck", "Walnut, fretless"],
      ["Head", "Natural skin-style"],
      ["Pot", "Open back, walnut"],
      ["Strings", "5-string"],
      ["Scale Length", '26.25"'],
    ],
    color: "#2e1a10"
  },
  {
    id: 7,
    name: "Mountain Dulcimer",
    type: "other",
    label: "Dulcimer",
    available: true,
    badge: null,
    price: 550,
    photo: "https://i.postimg.cc/K8WFxm5c/ba140368-34b3-4114-acf7-acf9be012655.jpg",
    materials: "Spruce top · Walnut back & sides · Heart soundholes",
    desc: "A traditional Appalachian mountain dulcimer with decorative heart and scroll soundholes. Three strings, easy to learn, and a gentle, singing tone. Perfect for beginners or folk enthusiasts.",
    specs: [
      ["Style", "Appalachian Mountain"],
      ["Top", "Spruce"],
      ["Back & Sides", "Walnut"],
      ["Soundholes", "Heart & scroll cutouts"],
      ["Strings", "3 (melody, middle, bass)"],
      ["Tuners", "Geared"],
    ],
    color: "#6b3d1a"
  },
  {
    id: 8,
    name: "OM Guitar — Cedar Top",
    type: "guitar",
    label: "Guitar",
    available: true,
    badge: "Available",
    price: 2900,
    photo: "https://i.postimg.cc/qvF04pGR/e4209d31-205f-42cd-8258-e5a10cab3572.jpg",
    materials: "Cedar top · Abalone rosette · Ebony fingerboard",
    desc: "A warm-voiced orchestra model with a western red cedar top. Cedar tops are prized for their quick response and rich warmth even at low volumes — ideal for fingerstyle players. Beautiful abalone rosette.",
    specs: [
      ["Body Style", "Orchestra Model"],
      ["Top", "Western Red Cedar"],
      ["Rosette", "Abalone"],
      ["Fingerboard", "Ebony"],
      ["Scale Length", '25.4"'],
      ["Nut Width", '1 3/4"'],
      ["Finish", "Nitrocellulose"],
    ],
    color: "#3a2015"
  },
];

let cart = [];
let currentFilter = 'all';

// ─── LIGHTBOX ────────────────────────────────────────────────────────────────
function openLightbox(src) {
  document.getElementById('lightboxImg').src = src;
  document.getElementById('lightboxOverlay').classList.add('open');
}
function closeLightbox(e) {
  if (!e || e.target === document.getElementById('lightboxOverlay') || e.target.classList.contains('lightbox-close')) {
    document.getElementById('lightboxOverlay').classList.remove('open');
  }
}

// ─── GUITAR SVG FOR CARDS ────────────────────────────────────────────────────
function guitarSVG(color = '#2a1810') {
  return `<svg viewBox="0 0 160 280" width="100" height="175" fill="none" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="80" cy="195" rx="52" ry="60" fill="${color}"/>
    <ellipse cx="80" cy="155" rx="40" ry="44" fill="${color}"/>
    <rect x="56" y="148" width="48" height="50" fill="${color}" opacity="0.95"/>
    <circle cx="80" cy="162" r="17" fill="#0d0905"/>
    <circle cx="80" cy="162" r="15" fill="none" stroke="#c8772a" stroke-width="1.2" opacity="0.6"/>
    <line x1="70" y1="112" x2="72" y2="238" stroke="#b8963c" stroke-width="0.6" opacity="0.5"/>
    <line x1="74" y1="112" x2="76" y2="238" stroke="#b8963c" stroke-width="0.6" opacity="0.5"/>
    <line x1="78" y1="112" x2="80" y2="238" stroke="#b8963c" stroke-width="0.6" opacity="0.5"/>
    <line x1="82" y1="112" x2="84" y2="238" stroke="#b8963c" stroke-width="0.6" opacity="0.5"/>
    <line x1="86" y1="112" x2="88" y2="238" stroke="#b8963c" stroke-width="0.6" opacity="0.5"/>
    <line x1="90" y1="112" x2="92" y2="238" stroke="#b8963c" stroke-width="0.6" opacity="0.5"/>
    <rect x="73" y="40" width="14" height="80" fill="#1e1208" rx="2"/>
    <line x1="73" y1="60" x2="87" y2="60" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <line x1="73" y1="70" x2="87" y2="70" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <line x1="73" y1="80" x2="87" y2="80" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <line x1="73" y1="89" x2="87" y2="89" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <line x1="73" y1="97" x2="87" y2="97" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <line x1="73" y1="104" x2="87" y2="104" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <rect x="70" y="23" width="20" height="22" rx="3" fill="#1e1208"/>
    <circle cx="73" cy="29" r="2.5" fill="#c8772a" opacity="0.8"/>
    <circle cx="73" cy="37" r="2.5" fill="#c8772a" opacity="0.8"/>
    <circle cx="87" cy="29" r="2.5" fill="#c8772a" opacity="0.8"/>
    <circle cx="87" cy="37" r="2.5" fill="#c8772a" opacity="0.8"/>
    <rect x="71" y="228" width="18" height="6" rx="1" fill="#c8772a" opacity="0.8"/>
  </svg>`;
}

function mandolinSVG() {
  return `<svg viewBox="0 0 140 260" width="90" height="165" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M70 220 C30 220 20 180 20 155 C20 130 35 115 70 115 C105 115 120 130 120 155 C120 180 110 220 70 220Z" fill="#2e1a10"/>
    <circle cx="70" cy="160" r="20" fill="#0d0905"/>
    <circle cx="70" cy="160" r="17" fill="none" stroke="#c8772a" stroke-width="1.2" opacity="0.6"/>
    <rect x="64" y="40" width="12" height="78" fill="#1e1208" rx="2"/>
    <line x1="64" y1="55" x2="76" y2="55" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <line x1="64" y1="65" x2="76" y2="65" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <line x1="64" y1="74" x2="76" y2="74" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <line x1="64" y1="82" x2="76" y2="82" stroke="#c8772a" stroke-width="0.8" opacity="0.4"/>
    <rect x="60" y="18" width="20" height="26" rx="3" fill="#1e1208"/>
    <circle cx="63" cy="25" r="2" fill="#c8772a" opacity="0.8"/>
    <circle cx="63" cy="33" r="2" fill="#c8772a" opacity="0.8"/>
    <circle cx="63" cy="40" r="2" fill="#c8772a" opacity="0.8"/>
    <circle cx="77" cy="25" r="2" fill="#c8772a" opacity="0.8"/>
    <circle cx="77" cy="33" r="2" fill="#c8772a" opacity="0.8"/>
    <circle cx="77" cy="40" r="2" fill="#c8772a" opacity="0.8"/>
    <line x1="66" y1="116" x2="68" y2="200" stroke="#b8963c" stroke-width="0.5" opacity="0.5"/>
    <line x1="68.5" y1="116" x2="70.5" y2="200" stroke="#b8963c" stroke-width="0.5" opacity="0.5"/>
    <line x1="71" y1="116" x2="73" y2="200" stroke="#b8963c" stroke-width="0.5" opacity="0.5"/>
    <line x1="73.5" y1="116" x2="75.5" y2="200" stroke="#b8963c" stroke-width="0.5" opacity="0.5"/>
  </svg>`;
}

// ─── RENDER PRODUCTS ─────────────────────────────────────────────────────────
function renderProducts() {
  const grid = document.getElementById('productsGrid');
  const filtered = currentFilter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.type === currentFilter);
  
  grid.innerHTML = filtered.map(p => `
    <div class="product-card fade-in" onclick="openProductModal(${p.id})">
      <div class="product-img" style="background:${p.color}">
        ${p.photo
          ? `<img src="${p.photo}" alt="${p.name}" referrerpolicy="no-referrer" crossorigin="anonymous" style="width:100%;height:100%;object-fit:cover;object-position:center;transition:transform 0.5s ease;">`
          : (p.type === 'other' ? mandolinSVG() : guitarSVG(p.color))
        }
        ${p.badge ? `<div class="product-badge">${p.badge}</div>` : ''}
      </div>
      <div class="product-info">
        <div class="product-type">${p.label}</div>
        <div class="product-name">${p.name}</div>
        <div class="product-materials">${p.materials}</div>
        <div class="product-footer">
          <div class="product-price">${p.available ? '$' + p.price.toLocaleString() : 'Sold'}</div>
          <button class="add-to-cart ${!p.available ? 'sold' : ''}"
            onclick="event.stopPropagation(); ${p.available ? 'addToCart(' + p.id + ')' : ''}"
          >${p.available ? 'Add to Cart' : 'Sold'}</button>
        </div>
      </div>
    </div>
  `).join('');
  
  setTimeout(initFadeIn, 50);
}

// ─── FILTER ──────────────────────────────────────────────────────────────────
function filterProducts(type, btn) {
  currentFilter = type;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderProducts();
}

// ─── CART ────────────────────────────────────────────────────────────────────
function addToCart(id) {
  const p = PRODUCTS.find(x => x.id === id);
  if (!p || !p.available) return;
  if (cart.find(c => c.id === id)) {
    showToast(`${p.name} is already in your cart`);
    return;
  }
  cart.push({ ...p });
  updateCartUI();
  showToast(`${p.name} added to cart`);
}

function removeFromCart(id) {
  cart = cart.filter(c => c.id !== id);
  updateCartUI();
}

function updateCartUI() {
  const count = cart.length;
  const countEl = document.getElementById('cartCount');
  countEl.textContent = count;
  countEl.style.display = count > 0 ? 'flex' : 'none';
  
  const list = document.getElementById('cartItemsList');
  const footer = document.getElementById('cartFooter');
  
  if (count === 0) {
    list.innerHTML = '<p class="cart-empty">Your cart is empty.</p>';
    footer.style.display = 'none';
    return;
  }
  
  footer.style.display = 'block';
  list.innerHTML = cart.map(p => `
    <div class="cart-item">
      <div class="cart-item-img">${p.type === 'other' ? mandolinSVG() : guitarSVG(p.color)}</div>
      <div class="cart-item-info">
        <div class="cart-item-name">${p.name}</div>
        <div class="cart-item-sub">${p.materials.split('·')[0].trim()}</div>
        <div class="cart-item-price">$${p.price.toLocaleString()}</div>
      </div>
      <button class="cart-item-remove" onclick="removeFromCart(${p.id})">✕</button>
    </div>
  `).join('');
  
  const total = cart.reduce((s, p) => s + p.price, 0);
  document.getElementById('cartTotal').textContent = '$' + total.toLocaleString();
}

function openCart() {
  document.getElementById('cartOverlay').classList.add('open');
  document.getElementById('cartDrawer').classList.add('open');
}
function closeCart() {
  document.getElementById('cartOverlay').classList.remove('open');
  document.getElementById('cartDrawer').classList.remove('open');
}

// ─── PRODUCT MODAL ───────────────────────────────────────────────────────────
function openProductModal(id) {
  const p = PRODUCTS.find(x => x.id === id);
  if (!p) return;
  
  document.getElementById('modalImg').innerHTML = `
    <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:${p.color};min-height:400px;overflow:hidden;">
      ${p.photo
        ? `<img src="${p.photo}" alt="${p.name}" referrerpolicy="no-referrer" crossorigin="anonymous" style="width:100%;height:100%;object-fit:cover;object-position:center;">`
        : (p.type === 'other' ? `<svg viewBox="0 0 140 260" width="140" height="260" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M70 220 C30 220 20 180 20 155 C20 130 35 115 70 115 C105 115 120 130 120 155 C120 180 110 220 70 220Z" fill="#4a2e1a" opacity="0.9"/>
        <circle cx="70" cy="160" r="22" fill="#0d0905"/>
        <circle cx="70" cy="160" r="18" fill="none" stroke="#c8772a" stroke-width="1.5" opacity="0.7"/>
        <rect x="63" y="38" width="14" height="80" fill="#2e1a10" rx="3"/>
        <rect x="59" y="16" width="22" height="28" rx="4" fill="#2e1a10"/>
        </svg>` : `<svg viewBox="0 0 200 350" width="170" height="297" fill="none" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="100" cy="240" rx="65" ry="75" fill="#4a2e1a" opacity="0.9"/>
        <ellipse cx="100" cy="190" rx="50" ry="55" fill="#4a2e1a" opacity="0.9"/>
        <rect x="70" y="182" width="60" height="63" fill="#3a2218" opacity="0.95"/>
        <circle cx="100" cy="200" r="21" fill="#0d0905"/>
        <circle cx="100" cy="200" r="18" fill="none" stroke="#c8772a" stroke-width="1.5" opacity="0.7"/>
        <rect x="91" y="50" width="18" height="95" fill="#2a1810" rx="3"/>
        <rect x="86" y="28" width="28" height="30" rx="4" fill="#2a1810"/>
        </svg>`)
      }
    </div>
  `;
  
  document.getElementById('modalBody').innerHTML = `
    <div class="modal-type">${p.label}</div>
    <div class="modal-name">${p.name}</div>
    <div class="modal-price">${p.available ? '$' + p.price.toLocaleString() : 'Sold — Commission Available'}</div>
    <div class="modal-divider"></div>
    <div class="modal-desc">${p.desc}</div>
    <div class="modal-specs">
      <div class="modal-specs-title">Specifications</div>
      ${p.specs.map(s => `<div class="spec-row"><span class="spec-key">${s[0]}</span><span class="spec-val">${s[1]}</span></div>`).join('')}
    </div>
    <button class="modal-add ${!p.available ? 'sold' : ''}"
      onclick="${p.available ? 'addToCart(' + p.id + '); closeProductModal();' : ''}">
      ${p.available ? 'Add to Cart' : 'Sold — Enquire About Similar Build'}
    </button>
  `;
  
  document.getElementById('productModal').classList.add('open');
}

function closeProductModal() {
  document.getElementById('productModal').classList.remove('open');
}
function closeModal(e) {
  if (e.target === document.getElementById('productModal')) closeProductModal();
}

// ─── CHECKOUT ────────────────────────────────────────────────────────────────
function openCheckout() {
  closeCart();
  
  const total = cart.reduce((s, p) => s + p.price, 0);
  document.getElementById('checkoutSummary').innerHTML = `
    <div class="checkout-summary-title">Order Summary</div>
    ${cart.map(p => `<div class="checkout-item-row"><span>${p.name}</span><span>$${p.price.toLocaleString()}</span></div>`).join('')}
    <div class="checkout-total-row">
      <span>Total</span>
      <span>$${total.toLocaleString()}</span>
    </div>
  `;
  
  document.getElementById('checkoutOverlay').classList.add('open');
}

function closeCheckout(e) {
  if (e.target === document.getElementById('checkoutOverlay')) closeCheckoutModal();
}
function closeCheckoutModal() {
  document.getElementById('checkoutOverlay').classList.remove('open');
  document.getElementById('checkoutSuccess').classList.remove('show');
  document.getElementById('checkoutFormWrap').style.display = 'block';
}

function submitCheckout() {
  const first = document.getElementById('ch_first').value.trim();
  const email = document.getElementById('ch_email').value.trim();
  if (!first || !email) { showToast('Please fill in your name and email'); return; }
  
  // In production: send to backend / email service / CRM
  console.log('Purchase enquiry submitted', {
    customer: { first, last: document.getElementById('ch_last').value, email, phone: document.getElementById('ch_phone').value, country: document.getElementById('ch_country').value },
    notes: document.getElementById('ch_notes').value,
    items: cart.map(p => ({ id: p.id, name: p.name, price: p.price })),
    total: cart.reduce((s, p) => s + p.price, 0)
  });
  
  cart = [];
  updateCartUI();
  document.getElementById('checkoutFormWrap').style.display = 'none';
  document.getElementById('checkoutSuccess').classList.add('show');
}

// ─── COMMISSION ──────────────────────────────────────────────────────────────
function submitCommission() {
  const first = document.getElementById('cf_first').value.trim();
  const email = document.getElementById('cf_email').value.trim();
  if (!first || !email) { showToast('Please fill in your name and email'); return; }
  
  console.log('Commission enquiry submitted', {
    name: first + ' ' + document.getElementById('cf_last').value,
    email,
    type: document.getElementById('cf_type').value,
    budget: document.getElementById('cf_budget').value,
    message: document.getElementById('cf_message').value
  });
  
  document.getElementById('commissionFormWrap').style.display = 'none';
  document.getElementById('commissionSuccess').classList.add('show');
}

// ─── TOAST ───────────────────────────────────────────────────────────────────
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2800);
}

// ─── FADE IN ─────────────────────────────────────────────────────────────────
function initFadeIn() {
  const els = document.querySelectorAll('.fade-in:not(.visible)');
  const obs = new IntersectionObserver((entries) => {
    entries.forEach((e, i) => {
      if (e.isIntersecting) {
        setTimeout(() => e.target.classList.add('visible'), i * 80);
        obs.unobserve(e.target);
      }
    });
  }, { threshold: 0.05, rootMargin: '0px 0px -40px 0px' });
  els.forEach(el => obs.observe(el));
}

// ─── SCROLL HELPER ───────────────────────────────────────────────────────────
function scrollTo(id) {
  document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
}

// ─── INIT ────────────────────────────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
  renderProducts();
  initFadeIn();
  initHeroSlideshow();
  renderJournal();
  loadArticlesFromFirestore();
  checkArticleDeepLink();

  // Re-run fade-in on scroll
  window.addEventListener('scroll', () => {
    initFadeIn();
    // Shrink nav on scroll
    const nav = document.getElementById('navbar');
    if (window.scrollY > 60) {
      nav.style.padding = '0.8rem 3rem';
    } else {
      nav.style.padding = '1.2rem 3rem';
    }
  }, { passive: true });
});

// ─── ADMIN ACCESS ─────────────────────────────────────────────────────────────
// Admin is accessed via the hidden "Admin" link at the end of the nav bar.
// It's invisible until hovered — the password requirement keeps it secure.


// Password lives in Firestore: collection "admin", document "config",
// fields: { password: "...", recoveryEmail: "..." }
// You never hardcode the password in this file.

let adminUnlocked = false;
let GALLERY_EXTRA = [];
let firestoreAdminDoc = null; // cached after first fetch

// ── Firebase helpers ──────────────────────────────────────────────────────────
async function getAdminDoc() {
  if (!db) return null;
  try {
    const snap = await db.collection('admin').doc('config').get();
    return snap.exists ? snap.data() : null;
  } catch(e) {
    console.warn('Firestore read error:', e);
    return null;
  }
}

async function setAdminDoc(data) {
  if (!db) return false;
  try {
    await db.collection('admin').doc('config').set(data, { merge: true });
    return true;
  } catch(e) {
    console.warn('Firestore write error:', e);
    return false;
  }
}

// ── Open / close ──────────────────────────────────────────────────────────────
function openAdmin() {
  document.getElementById('adminOverlay').classList.add('open');
  if (adminUnlocked) {
    showAdminMain();
  } else {
    showLogin();
    setTimeout(() => document.getElementById('adminPw').focus(), 200);
  }
}

function closeAdmin() {
  document.getElementById('adminOverlay').classList.remove('open');
}

function closeAdminCheck(e) {
  if (e.target === document.getElementById('adminOverlay')) closeAdmin();
}

// ── Login screen helpers ──────────────────────────────────────────────────────
function showLogin() {
  document.getElementById('adminLoginForm').style.display = 'block';
  document.getElementById('adminChangePwForm').style.display = 'none';
  document.getElementById('adminRecoveryForm').style.display = 'none';
}

function showRecovery() {
  document.getElementById('adminLoginForm').style.display = 'none';
  document.getElementById('adminChangePwForm').style.display = 'none';
  document.getElementById('adminRecoveryForm').style.display = 'block';
  document.getElementById('recoveryEmail').value = '';
  document.getElementById('recoveryHint').textContent = '';
}

function showChangePw() {
  document.getElementById('adminLoginForm').style.display = 'none';
  document.getElementById('adminChangePwForm').style.display = 'block';
  document.getElementById('adminRecoveryForm').style.display = 'none';
  document.getElementById('cp_current').value = '';
  document.getElementById('cp_new').value = '';
  document.getElementById('cp_confirm').value = '';
  document.getElementById('changePwHint').textContent = '';
}

function togglePwVisibility() {
  const f = document.getElementById('adminPw');
  const b = document.getElementById('pwToggleBtn');
  if (f.type === 'password') { f.type = 'text'; b.textContent = '🙈'; }
  else { f.type = 'password'; b.textContent = '👁'; }
}

// ── Check password against Firestore ─────────────────────────────────────────
async function checkAdminPw() {
  const btn = document.getElementById('loginBtn');
  const hint = document.getElementById('adminPwHint');
  const pw = document.getElementById('adminPw').value.trim();

  if (!pw) { hint.textContent = 'Please enter a password.'; hint.style.color='#e88'; return; }

  btn.textContent = 'Checking…';
  btn.disabled = true;
  hint.textContent = '';

  // If Firebase isn't configured yet, fall back gracefully
  if (!db) {
    hint.textContent = 'Firebase not connected — fill in credentials at top of file.';
    hint.style.color = '#e88';
    btn.textContent = 'Unlock →';
    btn.disabled = false;
    return;
  }

  const data = await getAdminDoc();

  if (!data) {
    // No doc exists yet — first-time setup: accept any password and save it
    const saved = await setAdminDoc({ password: pw, recoveryEmail: '' });
    if (saved) {
      adminUnlocked = true;
      firestoreAdminDoc = { password: pw, recoveryEmail: '' };
      showAdminMain();
    } else {
      hint.textContent = 'Could not connect to Firebase. Check credentials.';
      hint.style.color = '#e88';
    }
  } else if (pw === data.password) {
    adminUnlocked = true;
    firestoreAdminDoc = data;
    showAdminMain();
  } else {
    hint.textContent = 'Incorrect password. Try again.';
    hint.style.color = '#e88';
    document.getElementById('adminPw').value = '';
    document.getElementById('adminPw').focus();
  }

  btn.textContent = 'Unlock →';
  btn.disabled = false;
}

// ── Change password ───────────────────────────────────────────────────────────
async function changePassword() {
  const current = document.getElementById('cp_current').value.trim();
  const newPw   = document.getElementById('cp_new').value.trim();
  const confirm = document.getElementById('cp_confirm').value.trim();
  const hint    = document.getElementById('changePwHint');

  if (!current || !newPw || !confirm) { hint.textContent='Fill in all fields.'; hint.style.color='#e88'; return; }
  if (newPw !== confirm)              { hint.textContent='New passwords do not match.'; hint.style.color='#e88'; return; }
  if (newPw.length < 6)               { hint.textContent='Password must be at least 6 characters.'; hint.style.color='#e88'; return; }

  if (!db) { hint.textContent='Firebase not connected.'; hint.style.color='#e88'; return; }

  const data = await getAdminDoc();
  if (!data || current !== data.password) {
    hint.textContent = 'Current password is wrong.';
    hint.style.color = '#e88';
    return;
  }

  const ok = await setAdminDoc({ password: newPw });
  if (ok) {
    firestoreAdminDoc = { ...firestoreAdminDoc, password: newPw };
    hint.textContent = '✓ Password updated!';
    hint.style.color = 'var(--amber-light)';
    setTimeout(() => {
      document.getElementById('adminChangePwForm').style.display = 'none';
      document.getElementById('adminLoginForm').style.display = 'block';
    }, 1800);
  } else {
    hint.textContent = 'Save failed — check Firebase permissions.';
    hint.style.color = '#e88';
  }
}

// ── Password recovery via EmailJS ─────────────────────────────────────────────
async function sendRecovery() {
  const enteredEmail = document.getElementById('recoveryEmail').value.trim().toLowerCase();
  const hint = document.getElementById('recoveryHint');
  const btn  = document.getElementById('recoveryBtn');

  if (!enteredEmail) { hint.textContent='Please enter your email address.'; hint.style.color='#e88'; return; }

  if (!db) {
    hint.textContent = 'Firebase not connected.';
    hint.style.color = '#e88';
    return;
  }

  btn.textContent = 'Sending…';
  btn.disabled = true;
  hint.textContent = '';

  const data = await getAdminDoc();

  if (!data || !data.recoveryEmail) {
    hint.textContent = 'No recovery email is set in Firebase yet. Ask your site helper.';
    hint.style.color = '#e88';
    btn.textContent = 'Send Recovery Email →';
    btn.disabled = false;
    return;
  }

  if (enteredEmail !== data.recoveryEmail.toLowerCase()) {
    // IMPORTANT: we give the same message either way — never confirm/deny which emails exist
    hint.textContent = 'If that email matches our records, a recovery message has been sent.';
    hint.style.color = 'var(--amber-light)';
    btn.textContent = 'Send Recovery Email →';
    btn.disabled = false;
    return;
  }

  // Email matches — send via EmailJS
  // Template variables sent: {{to_email}}, {{password}}, {{site_name}}
  try {
    await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
      to_email:  data.recoveryEmail,
      password:  data.password,
      site_name: 'Siler Stringed Instruments'
    });
    hint.textContent = '✓ Recovery email sent! Check your inbox.';
    hint.style.color = 'var(--amber-light)';
  } catch(e) {
    console.error('EmailJS error:', e);
    hint.textContent = 'Email send failed. Check your EmailJS configuration.';
    hint.style.color = '#e88';
  }

  btn.textContent = 'Send Recovery Email →';
  btn.disabled = false;
}

// ── Show main admin after login ───────────────────────────────────────────────
function showAdminMain() {
  document.getElementById('adminLogin').style.display = 'none';
  document.getElementById('adminMain').style.display = 'block';
  switchAdminTab('add', document.querySelector('.admin-tab'));
  // Show Firebase connection status
  updateFirebaseStatus();
}

function updateFirebaseStatus() {
  const dot = document.getElementById('firebaseStatusDot');
  const txt = document.getElementById('firebaseStatusTxt');
  if (!dot || !txt) return;
  if (db) {
    dot.className = 'admin-status-dot connected';
    txt.textContent = 'Firebase connected';
  } else {
    dot.className = 'admin-status-dot error';
    txt.textContent = 'Firebase not configured';
  }
}

function showChangePwFromMain() {
  document.getElementById('adminMain').style.display = 'none';
  document.getElementById('adminLogin').style.display = 'block';
  showChangePw();
}


  document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.admin-tab-content').forEach(c => c.style.display = 'none');
  btn.classList.add('active');
  document.getElementById('tab-' + tab).style.display = 'block';
  if (tab === 'manage') renderAdminProductList();
  if (tab === 'gallery') renderAdminGalleryList();
}

function previewPhoto(url) {
  const area = document.getElementById('imgUploadArea');
  const preview = document.getElementById('uploadPreview');
  const img = document.getElementById('uploadPreviewImg');
  if (url && url.startsWith('http')) {
    img.src = url;
    img.style.display = 'block';
    preview.style.display = 'none';
    area.classList.add('has-img');
  } else {
    img.style.display = 'none';
    preview.style.display = 'flex';
    area.classList.remove('has-img');
  }
}

async function pasteFromClipboard(inputId) {
  try {
    const text = await navigator.clipboard.readText();
    document.getElementById(inputId).value = text;
    if (inputId === 'add_photo') previewPhoto(text);
  } catch(e) {
    showToast('Paste shortcut: use Ctrl+V / Cmd+V in the field');
  }
}

function addProduct() {
  const photo = document.getElementById('add_photo').value.trim();
  const name = document.getElementById('add_name').value.trim();
  const price = parseInt(document.getElementById('add_price').value) || 0;
  const type = document.getElementById('add_type').value;
  const label = document.getElementById('add_label').value.trim() || type.charAt(0).toUpperCase() + type.slice(1);
  const materials = document.getElementById('add_materials').value.trim();
  const desc = document.getElementById('add_desc').value.trim();
  const badge = document.getElementById('add_badge').value.trim() || null;
  const available = document.getElementById('add_available').checked;

  if (!name) { showToast('Please enter an instrument name'); return; }
  if (!price) { showToast('Please enter a price'); return; }

  const newId = Math.max(...PRODUCTS.map(p => p.id), 0) + 1;
  PRODUCTS.push({
    id: newId, name, type, label, available, badge, price,
    photo: photo || null, materials, desc, specs: [], color: '#2a1810'
  });

  renderProducts();

  // Reset form
  ['add_photo','add_name','add_price','add_label','add_materials','add_desc','add_badge'].forEach(id => {
    document.getElementById(id).value = '';
  });
  document.getElementById('add_available').checked = true;
  previewPhoto('');

  document.getElementById('addSuccess').style.display = 'block';
  setTimeout(() => document.getElementById('addSuccess').style.display = 'none', 3500);
  showToast('Listing added!');
}

function renderAdminProductList() {
  const list = document.getElementById('adminProductList');
  if (!PRODUCTS.length) {
    list.innerHTML = '<p style="color:rgba(245,240,232,0.4);font-style:italic;font-size:0.85rem">No listings yet.</p>';
    return;
  }
  list.innerHTML = PRODUCTS.map(p => `
    <div class="admin-product-row">
      ${p.photo
        ? `<img class="admin-product-thumb" src="${p.photo}" alt="${p.name}">`
        : `<div class="admin-product-thumb-placeholder">♪</div>`}
      <div class="admin-product-info">
        <div class="admin-product-name">${p.name}</div>
        <div class="admin-product-meta">$${p.price.toLocaleString()} · ${p.available ? '✓ Available' : '✗ Sold'}</div>
      </div>
      <div class="admin-product-actions">
        <button class="admin-btn-toggle" onclick="toggleAvailable(${p.id})">${p.available ? 'Mark Sold' : 'Mark Avail.'}</button>
        <button class="admin-btn-delete" onclick="deleteProduct(${p.id})">Delete</button>
      </div>
    </div>
  `).join('');
}

function toggleAvailable(id) {
  const p = PRODUCTS.find(x => x.id === id);
  if (p) { p.available = !p.available; renderProducts(); renderAdminProductList(); }
}

function deleteProduct(id) {
  if (!confirm('Remove this listing from the shop?')) return;
  const idx = PRODUCTS.findIndex(x => x.id === id);
  if (idx !== -1) { PRODUCTS.splice(idx, 1); renderProducts(); renderAdminProductList(); }
}

function addGalleryImage() {
  const url = document.getElementById('gal_url').value.trim();
  const caption = document.getElementById('gal_caption').value.trim() || 'New Image';
  if (!url) { showToast('Please enter an image URL'); return; }

  // Add a new gallery item to the DOM dynamically
  const grid = document.querySelector('.gallery-grid');
  if (!grid) return;

  const div = document.createElement('div');
  div.className = 'gallery-item fade-in';
  div.setAttribute('onclick', `openLightbox('${url}')`);
  div.innerHTML = `
    <img src="${url}" alt="${caption}">
    <div class="gallery-item-caption"><span>${caption}</span></div>
  `;
  grid.appendChild(div);
  initFadeIn();

  GALLERY_EXTRA.push({ url, caption });

  document.getElementById('gal_url').value = '';
  document.getElementById('gal_caption').value = '';
  document.getElementById('galSuccess').style.display = 'block';
  setTimeout(() => document.getElementById('galSuccess').style.display = 'none', 3500);
  renderAdminGalleryList();
}

function renderAdminGalleryList() {
  const list = document.getElementById('adminGalleryList');
  const allGalleryImgs = [
    { url: 'https://i.postimg.cc/RZh9kWKY/04f7295c-b0ce-4d9d-af21-21108906b0b6.jpg', caption: 'Headstock Detail' },
    { url: 'https://i.postimg.cc/vZTMJ4fW/1c7d037b-29b4-4a06-a763-99bc023d6a5d.jpg', caption: 'Dreadnought Guitar' },
    { url: 'https://i.postimg.cc/9QkVCcYg/27dab5c9-86b3-4364-9fa0-80342a9eb47f.jpg', caption: 'Abalone Vine Inlay' },
    { url: 'https://i.postimg.cc/RZY94vLY/353acdf0-f47b-4f9c-abf1-c6c6e930395b.jpg', caption: 'Celtic Harp' },
    { url: 'https://i.postimg.cc/rwscBDxZ/3e53de8b-c1ba-4a2f-9b54-69ed59a40be8.jpg', caption: 'Label — Est. 1980' },
    { url: 'https://i.postimg.cc/9Q0V6DZs/5df96386-a597-47c6-8c2f-2b8d78f9544c.jpg', caption: 'Binding Detail' },
    { url: 'https://i.postimg.cc/rwHcMqNY/67cbc9fa-2dde-4733-bcd5-19080bf1520b.jpg', caption: 'Purfling Detail' },
    { url: 'https://i.postimg.cc/NjFY3Km3/6cf208a8-d30d-4e95-9f1b-87e04f6c49b4.jpg', caption: 'Osage Orange Back' },
    { url: 'https://i.postimg.cc/Cx2YSwsQ/7d809df8-9f93-4fe3-a280-84f201a2f739.jpg', caption: 'OM Rosette 2018' },
    { url: 'https://i.postimg.cc/jS1KtR4p/961e6be5-2607-4460-add8-cdbc6b092fc2.jpg', caption: 'Sunburst OM' },
    { url: 'https://i.postimg.cc/nhWZpn18/a37e3ad9-9cde-4693-866f-718340124dde.jpg', caption: 'Figured Back' },
    { url: 'https://i.postimg.cc/7ZRDwqNk/abc8270f-55ac-45cd-a8e9-e945d886dbfb.jpg', caption: 'Dennis Siler' },
    { url: 'https://i.postimg.cc/3xq7Y3ZH/b2ce22ca-6c83-486d-9a17-6103cf7d6567.jpg', caption: 'Minstrel Banjo' },
    { url: 'https://i.postimg.cc/K8WFxm5c/ba140368-34b3-4114-acf7-acf9be012655.jpg', caption: 'Mountain Dulcimer' },
    { url: 'https://i.postimg.cc/jS1KtRhS/bc3825ae-9d44-42c2-a195-fe4185a46431.jpg', caption: 'Rosewood Back & Neck' },
    { url: 'https://i.postimg.cc/Vkh1mzFv/d4c5c5d3-4de7-476c-88dd-bff5f4d25237.jpg', caption: 'Abalone Edge Binding' },
    { url: 'https://i.postimg.cc/qvF04pGR/e4209d31-205f-42cd-8258-e5a10cab3572.jpg', caption: '12-String Guitar' },
    { url: 'https://i.postimg.cc/Pq8Hq06d/eccd866f-04ee-4f7b-85ed-d2dcd0e58f52.jpg', caption: 'OM Guitar in Case' },
    ...GALLERY_EXTRA
  ];

  list.innerHTML = allGalleryImgs.map((img, i) => `
    <div class="gal-admin-thumb" title="${img.caption}">
      <img src="${img.url}" alt="${img.caption}">
    </div>
  `).join('');

}

// ─── HERO SLIDESHOW ───────────────────────────────────────────────────────────
const HERO_IMAGES = [
  { url: 'https://i.postimg.cc/vZTMJ4fW/1c7d037b-29b4-4a06-a763-99bc023d6a5d.jpg', alt: 'Siler dreadnought guitar' },
  { url: 'https://i.postimg.cc/9QkVCcYg/27dab5c9-86b3-4364-9fa0-80342a9eb47f.jpg', alt: 'Abalone vine fretboard inlay' },
  { url: 'https://i.postimg.cc/RZY94vLY/353acdf0-f47b-4f9c-abf1-c6c6e930395b.jpg', alt: 'Celtic harp in workshop' },
  { url: 'https://i.postimg.cc/NjFY3Km3/6cf208a8-d30d-4e95-9f1b-87e04f6c49b4.jpg', alt: 'Osage orange guitar back' },
  { url: 'https://i.postimg.cc/Cx2YSwsQ/7d809df8-9f93-4fe3-a280-84f201a2f739.jpg', alt: 'OM guitar abalone rosette' },
  { url: 'https://i.postimg.cc/nhWZpn18/a37e3ad9-9cde-4693-866f-718340124dde.jpg', alt: 'Figured maple guitar back' },
  { url: 'https://i.postimg.cc/3xq7Y3ZH/b2ce22ca-6c83-486d-9a17-6103cf7d6567.jpg', alt: 'Minstrel banjo' },
  { url: 'https://i.postimg.cc/qvF04pGR/e4209d31-205f-42cd-8258-e5a10cab3572.jpg', alt: '12-string guitar' },
  { url: 'https://i.postimg.cc/Pq8Hq06d/eccd866f-04ee-4f7b-85ed-d2dcd0e58f52.jpg', alt: 'OM guitar in case' },
];

let heroCurrentSlide = 0;
let heroTimer = null;

function initHeroSlideshow() {
  const container = document.getElementById('heroSlideshow');
  const dotsEl    = document.getElementById('heroSlideDots');
  if (!container || !dotsEl) return;

  // Build slides
  container.innerHTML = HERO_IMAGES.map((img, i) => `
    <div class="hero-slide${i === 0 ? ' active' : ''}">
      <img src="${img.url}" alt="${img.alt}" referrerpolicy="no-referrer" loading="${i === 0 ? 'eager' : 'lazy'}">
    </div>
  `).join('');

  // Build dots
  dotsEl.innerHTML = HERO_IMAGES.map((_, i) => `
    <button class="hero-dot${i === 0 ? ' active' : ''}" onclick="heroGoTo(${i})" aria-label="Slide ${i+1}"></button>
  `).join('');

  startHeroTimer();
}

function heroGoTo(idx) {
  const slides = document.querySelectorAll('.hero-slide');
  const dots   = document.querySelectorAll('.hero-dot');
  slides[heroCurrentSlide]?.classList.remove('active');
  dots[heroCurrentSlide]?.classList.remove('active');
  heroCurrentSlide = (idx + HERO_IMAGES.length) % HERO_IMAGES.length;
  slides[heroCurrentSlide]?.classList.add('active');
  dots[heroCurrentSlide]?.classList.add('active');
}

function heroSlide(dir) {
  clearTimeout(heroTimer);
  heroGoTo(heroCurrentSlide + dir);
  startHeroTimer();
}

function startHeroTimer() {
  clearTimeout(heroTimer);
  heroTimer = setTimeout(() => {
    heroGoTo(heroCurrentSlide + 1);
    startHeroTimer();
  }, 4500);
}

// ─── JOURNAL / ARTICLES ───────────────────────────────────────────────────────
// Articles stored in memory (and optionally Firestore)
let ARTICLES = [];

function renderJournal() {
  const grid = document.getElementById('journalGrid');
  if (!grid) return;

  if (ARTICLES.length === 0) {
    grid.innerHTML = `
      <div class="journal-empty">
        <p style="font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:300;color:var(--muted)">Coming soon…</p>
        <p>Dennis will be sharing stories from the workshop — build processes, wood selection, and the stories behind his instruments.</p>
      </div>`;
    return;
  }

  grid.innerHTML = ARTICLES.slice().reverse().map(a => `
    <div class="journal-card fade-in" onclick="openArticle('${a.id}')">
      ${a.cover
        ? `<div class="journal-card-img"><img src="${a.cover}" alt="${a.title}" referrerpolicy="no-referrer" loading="lazy"></div>`
        : `<div class="journal-card-img-placeholder">♪</div>`}
      <div class="journal-card-body">
        <div class="journal-card-cat">${a.category}</div>
        <div class="journal-card-title">${a.title}</div>
        <div class="journal-card-excerpt">${a.excerpt}</div>
        <div class="journal-card-meta">${a.date}</div>
      </div>
    </div>
  `).join('');

  setTimeout(initFadeIn, 50);
}

function openArticle(id) {
  const a = ARTICLES.find(x => x.id === id);
  if (!a) return;

  const reader = document.getElementById('articleReader');
  reader.innerHTML = `
    ${a.cover
      ? `<img class="article-hero-img" src="${a.cover}" alt="${a.title}" referrerpolicy="no-referrer">`
      : `<div class="article-hero-placeholder">♪</div>`}
    <div class="article-header">
      <div class="article-cat">${a.category}</div>
      <h1 class="article-title">${a.title}</h1>
      <div class="article-byline">By Dennis J. Siler &nbsp;·&nbsp; ${a.date}</div>
    </div>
    <div class="article-body">${a.body}</div>
    <div class="article-footer">
      <button class="article-share-btn" onclick="shareArticle('${a.id}')">
        ↗ Share this Article
      </button>
      <button class="article-close-btn" onclick="closeArticle()">← Back to Journal</button>
    </div>
  `;

  // Store current article ID for sharing
  reader.dataset.articleId = id;
  document.getElementById('articleOverlay').classList.add('open');
  document.getElementById('articleOverlay').scrollTop = 0;
  document.body.style.overflow = 'hidden';
}

function closeArticle() {
  document.getElementById('articleOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

function closeArticleCheck(e) {
  if (e.target === document.getElementById('articleOverlay')) closeArticle();
}

function shareArticle(id) {
  const a = ARTICLES.find(x => x.id === id);
  if (!a) return;

  // Build a shareable message
  const url  = window.location.href.split('?')[0] + '?article=' + id;
  const text = `"${a.title}" — from Dennis Siler's Workshop Journal\n${url}`;

  if (navigator.share) {
    navigator.share({ title: a.title, text: `Read "${a.title}" on the Siler Instruments journal`, url })
      .catch(() => copyToClipboard(url));
  } else {
    copyToClipboard(url);
  }
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    const el = document.getElementById('shareCopied');
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 2800);
  }).catch(() => {
    // Fallback
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    const el = document.getElementById('shareCopied');
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 2800);
  });
}

// Check URL for article deep-link on load
function checkArticleDeepLink() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get('article');
  if (id && ARTICLES.find(x => x.id === id)) {
    openArticle(id);
  }
}

// ─── ADMIN: JOURNAL / ARTICLE EDITOR ─────────────────────────────────────────

function artFmt(cmd) {
  document.getElementById('artEditor').focus();
  document.execCommand(cmd, false, null);
}

function artFmtBlock(tag) {
  document.getElementById('artEditor').focus();
  document.execCommand('formatBlock', false, tag);
}

function artInsertImg(position) {
  const url = prompt('Paste the image URL (PostImg direct link):');
  if (!url || !url.startsWith('http')) return;
  const cls = position === 'full' ? '' : position === 'left' ? ' class="img-left"' : ' class="img-right"';
  const html = `<img src="${url}" referrerpolicy="no-referrer"${cls} alt=""><p></p>`;
  document.getElementById('artEditor').focus();
  document.execCommand('insertHTML', false, html);
}

function previewArticleCover(url) {
  const img = document.getElementById('art_cover_preview');
  if (url && url.startsWith('http')) {
    img.src = url;
    img.style.display = 'block';
  } else {
    img.style.display = 'none';
  }
}

async function publishArticle() {
  const title  = document.getElementById('art_title').value.trim();
  const cat    = document.getElementById('art_cat').value;
  const cover  = document.getElementById('art_cover').value.trim();
  const body   = document.getElementById('artEditor').innerHTML.trim();

  if (!title) { showToast('Please enter a title'); return; }
  if (!body || body === '<br>') { showToast('Please write something in the article body'); return; }

  // Extract excerpt from body (strip HTML)
  const tmp = document.createElement('div');
  tmp.innerHTML = body;
  const plainText = tmp.textContent || tmp.innerText || '';
  const excerpt = plainText.substring(0, 200).trim() + (plainText.length > 200 ? '…' : '');

  const now = new Date();
  const dateStr = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  const id = 'art_' + Date.now();

  const article = { id, title, category: cat, cover: cover || null, body, excerpt, date: dateStr };
  ARTICLES.push(article);

  // Save to Firestore if available
  if (db) {
    try {
      await db.collection('articles').doc(id).set(article);
    } catch(e) {
      console.warn('Firestore article save failed:', e);
    }
  }

  renderJournal();
  renderAdminArticleList();

  // Reset form
  document.getElementById('art_title').value = '';
  document.getElementById('art_cover').value = '';
  document.getElementById('art_cover_preview').style.display = 'none';
  document.getElementById('artEditor').innerHTML = '';

  document.getElementById('artSuccess').style.display = 'block';
  setTimeout(() => document.getElementById('artSuccess').style.display = 'none', 3500);
  showToast('Article published!');
}

function renderAdminArticleList() {
  const list = document.getElementById('adminArticleList');
  if (!list) return;
  if (ARTICLES.length === 0) {
    list.innerHTML = '<p style="color:rgba(245,240,232,0.35);font-style:italic;font-size:0.85rem">No articles yet. Write your first one above!</p>';
    return;
  }
  list.innerHTML = ARTICLES.slice().reverse().map(a => `
    <div class="journal-article-row">
      ${a.cover
        ? `<img class="journal-article-thumb" src="${a.cover}" alt="${a.title}" referrerpolicy="no-referrer">`
        : `<div class="journal-article-thumb" style="display:flex;align-items:center;justify-content:center;color:var(--amber);font-size:1.2rem">♪</div>`}
      <div class="journal-article-info">
        <div class="journal-article-title">${a.title}</div>
        <div class="journal-article-meta">${a.category} · ${a.date}</div>
      </div>
      <div class="admin-product-actions">
        <button class="admin-btn-delete" onclick="deleteArticle('${a.id}')">Delete</button>
      </div>
    </div>
  `).join('');
}

async function deleteArticle(id) {
  if (!confirm('Delete this article? This cannot be undone.')) return;
  const idx = ARTICLES.findIndex(x => x.id === id);
  if (idx !== -1) ARTICLES.splice(idx, 1);
  if (db) {
    try { await db.collection('articles').doc(id).delete(); } catch(e) {}
  }
  renderJournal();
  renderAdminArticleList();
}

// Load articles from Firestore on page load
async function loadArticlesFromFirestore() {
  if (!db) return;
  try {
    const snap = await db.collection('articles').orderBy('date').get();
    ARTICLES = snap.docs.map(d => d.data());
    renderJournal();
    checkArticleDeepLink();
  } catch(e) {
    console.warn('Could not load articles:', e);
    renderJournal();
  }
}

// Override switchAdminTab to handle journal tab
const _origSwitchTab = switchAdminTab;
function switchAdminTab(tab, btn) {
  _origSwitchTab(tab, btn);
  if (tab === 'journal') renderAdminArticleList();
}

</script>
</body>
</html>
